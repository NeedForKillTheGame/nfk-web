<a href="README.md">Read this README in English ></a>

# NFK-WEB
Need For Kill - Quake 3 in 2d - WebGL game

## Что такое NFK?
В начале 200х некто 3d[Power] сделал игру "Need For Kill" по мотивам Quake 3. Игра написана под Windows DirectX на Delphi.
В игре пристусвует мультиплеер, в интернете и на сегодняшний день сущствуют выделенные сервера для игры (к ним можно подключиться прямо из меню игры). В игре присутсвуют несколько режимов заимтствованных из Quake 3 и других игр: duel, teamplay, captu the flag, domintaion и прочие. Осовной фичей является продвинутая прогеймерская физика и отличный игровой баланс! В середине 200x по игре проводились LAN чемпионаты России с призовым фондом. Время от времени проходят online турниры.

Посмотрите этот короткий ролик, чтобы составить представление об игре: http://www.youtube.com/watch?v=FgvgVttl0zE

Больше видео можно найти на этих двух каналах: http://www.youtube.com/user/nfk2d и http://www.youtube.com/user/needforkilldemo

Скачать оригинальную игру Need For Kill можно с официального сайта: http://needforkill.ru/load/need_for_kill_0_77/22-1-0-494

К сожалению, исходные коды последней версии игры были утеряны автором после того, как он потерял интерес к разработке. Сохранились лишь бекапы одной из промежуточных версий. На основе этих "промежуточных" исходников ряд энтузиастов продолжают развивать последнюю версию игры, внося правки непосредсвенно на ассемблере. Но этот процесс очень трудоёмок и время от времени возникает идея переписать всё заново.

## Что такое NFK-WEB?
NFK-WEB - это проект нацеленный на перенос оригинальной игры под веб-платформу, но с сохранением физики и игрового баланса.

Демо: http://nfk.pqr.su/game/

## Технические детали
- Графика рендрится при помощи одной из самых популярных библиотек: <a href="http://www.pixijs.com/">Pixi.js</a> (WebGL или canvas, если первый не доступен в браузере пользователя)
- JavaScript код клиента написан на спецификации ECMAScript 2015 (ранее известного как ES6). Но поскольку не все фичи этой спецификации поддерживаются современными браузерами, код перед публикацией на сайт транслируется в поддерживаемый всеми ES5 с помощью библиотеки <a href="http://babeljs.io/">Babel</a>
- Сборка проекта с помощью системы <a href="http://webpack.github.io/">webpack</a>

## План работ
1. Переписать код отвечающий за коллизии (сейчас это выглядит как "спагетти" перенесённое из старых Delphi исходников)
2. Написать подробный мануал для разработчиков, как настроить окружение и систему сборки (node, webpack, ...), возможно, записать скринкаст
3. Реализовать первое оружие: Railgun!
4. Написать мультиплеер и серверную часть, для начала с одним режимом игры: Railarena
5. Запустить официальный сайт игры с регистрацией, статистикой игр, системой подбора подходящего по скилу игрока во время игры через сайт
6. Добавить больше оружий и типов игры: (duel, ctf и teamplay) 
7. Разработать продвинутый редактор карт
8. Текстуры, скины для моделей
9. Визуальные эффекты
10. Profit!!!

## Инструкция по программированию
Ниже вы найдёте пошаговую инструкцию, как начать программировать NFK-WEB.
Разрабатывать можно на Windows, OS X или Linux. Инструкция ниже написана на примере Windows, но на других ОС всё работает аналогичным образом.

Предполагается, что вы умеете пользоваться git и github, сделали форк, скачали исходники.

В рамках этого проекта планируется написать web-клиент в браузере на JavaScript + WebGL и сервер на Node.js (тоже JavaScript), общаться они будут по технологии WebSockets.
На текущий момент в этом репозитории есть код только клиентской части - физика и рендринг. Однако, для запуска на локальной машине вам всё же понадобится полноценный веб-сервер, чтобы правильно отдать в браузер html и js файлы (например, nginx, apache, iis или любой другой). Установка веб-сервера выходит за рамки этой инструкции, но вы можете прочитать, например, вот эту простую инструкцию по установке простейшего веб-сервера nginx: http://nginx.org/ru/docs/windows.html 

Кроме веб-сервера нам понадобится Node.js. Качаем и устанавливаем отсюда: http://nodejs.org/download/

После установки Node.js откройте консоль (cmd.exe) и перейдите в папку с репозиторием nfk-web.
 
Выполните следующие две команды, чтобы установить дополнительные утилиты, написанные под Node.js и необходимые для разработки:

Первая команда `npm install webpack -g` - устанавливает сборщик проектов <a href="http://webpack.github.io/">webpack</a> в качестве глобального пакета (флаг -g) в систему. В случае Windows файлы будут установлены в %UserProfile%\AppData\Roaming\npm\ и этот путь будет добавлен в PATH, таким образом вы сможете запускать утилиту webpack из сконсоли просто набрав `webpack`

Вторая команда `npm install` - устанавливает пакеты указанные в файлы package.json в текущей папке (а вы должны были в самом начале перейти в папку с клонированным репозиторем, таким образом package.json у вас уже есть!). Пакеты будут установлены локально внутри данной папки в подпапку node_modules. На самом деле здесь устанавливается всего одна утилита: <a href="http://babeljs.io/">Babel</a> - транслятор кода ECMAScript 2015 (современный стандарт JavaScript, который ещё не поддерживается всеми браузерами) в более старый стандарт ECMAScript 5, который поддерживается всеми браузерами.
 
Теперь у нас есть всё что нужно, можно открывать свой любимый редактор кода с подстветкой JavaScript (например, <a href="http://www.jetbrains.com/webstorm/">WebStorm</a>) и начинать кодить!
 
Исходный код состоит из index.html (основная разметка страницы) и множества JavaScript файлов из папки src, каждый из которых отвечает за свою часть логики игры (например Keyboard.js, Physics.js, Render.js). Это вам не оригинальный NFK, где почти весь код был в <a href="https://raw.githubusercontent.com/NeedForKillTheGame/nfk062b/master/Unit1.pas">Unti1.pas</a> на 30К строк :)

Однако, подгружать все js файлы отдельными script тегами внутри index.html не лучшая идея - загрузка страницы станет медленнее и вам нужно будет аккурато следить за зависимостями, чтобы самые нужные файлы загружались раньше, чем другие. Например, файл Constants.js содержит константы используемые во всех прочих модулях и он должен загружаться первым. На помощь приходит утилита webpack, которую вы уже установили. Эта утилита с помощью файла конфигурации webpack.config.js (лежит в корне репозитория) может склеить все *.js исходники из папки src в один файл build/gamebuild.js - именно этот файл подключается на странице index.html.

Чтобы после каждой правки в исходных src файлах не запускать webpack вручную, его можно запустить в режиме --watch, тогда webpack самостоятельно будет следить за изменениями в папке src и обновлять build/gamebuild.js автоматически. В корне репозитория есть файл **runwebpack.bat** который запускает `webpack --watch --color`, открывается окно консоли, которое можно свернуть (но не закрыть).
  
Код игры написан на последней версии стандарта языка JavaScript - ECMAScript 2015. Поскольку браузеры ещё не поддерживают этот стандарт в полном объёме (текущее состояние дел: http://kangax.github.io/compat-table/es6/), код нужно конвертировать в старый-добрый JavaScript ECMAScript 5 (http://kangax.github.io/compat-table/es5/). Этим занимается утилита Babel, которую вы уже установили. Но запускать её вручную не нужно, т.к. webpack.config.js содержит необходимые настроки для автоматического запуска Babel в процессе работы самого webpack.

Таким образом, запущенный *webpack --watch* делает следующее:
- смотрит за изменениями исходников в папке src, если что-то поменялось, то
- конвертирует изменённый файл из ECMAScript 2015 в ECMAScript 5 (сам файл не перезаписывается, конвертация только в памяти)
- склеивает с остальными исходниками из папки src (которые уже сконвертированы в ES5 и лежат в памяти процесса webpack) в нужном порядке
- записывает результат в build/gamebuild.js

Теперь можно обновить страницу в браузере и проверить новый код. 

Основной код, который выполняется при загружке страницы, находится в файле app.js - это своего рода аналог main из мира Си. Там находится бесконечный цикл, который с определённой частотой дёргает функции обновления физики и рендринга.

## Присоединяйся!
Проект с открытым исходным кодом под лицензией MIT. Принимаем баг-репорты и пул-реквесты!
В частности, ищем человека знающего толк в написании сетевого кода для мультиплеера (как клиентской, так и серверной части)

С нами можно связаться на irc канале: irc.wenet.ru:6667 #nfk (кодировка cp1251). Веб-портал для irc: http://needforkill.ru/index/web_chat/0-54

Или в чатике Gitter.im: [![Gitter](https://badges.gitter.im/Join%20Chat.svg)](https://gitter.im/NeedForKillTheGame?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge)

Мы в твиттере <a href="https://twitter.com/nfk2d">@nfk2d</a>