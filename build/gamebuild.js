!function(e){var t={};function s(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(i,a,function(t){return e[t]}.bind(null,a));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/build/",s(s.s=3)}([function(e,t){e.exports=Howl},function(e,t){e.exports=PIXI},function(e,t){e.exports=Stats},function(e,t,s){"use strict";s.r(t);var i={FPS:50,BRICK_WIDTH:32,BRICK_HEIGHT:16,PLAYER_WIDTH:20,PLAYER_HEIGHT:48,PLAYER_HEIGHT_CROUCH:32,PLAYER_MAX_VELOCITY_X:3,C_TEAMBLUE:0,C_TEAMRED:1,C_TEAMNON:2,C_WPN_GAUNTLET:0,C_WPN_MACHINE:1,C_WPN_SHOTGUN:2,C_WPN_GRENADE:3,C_WPN_ROCKET:4,C_WPN_SHAFT:5,C_WPN_RAIL:6,C_WPN_PLASMA:7,C_WPN_BFG:8,DIR_LW:0,DIR_RW:1,DIR_LS:2,DIR_RS:3,GAMETYPE_FFA:0,GAMETYPE_1V1:1,GAMETYPE_TEAM:2,GAMETYPE_CTF:3,GAMETYPE_RAILARENA:4,GAMETYPE_TRIXARENA:5,GAMETYPE_PRACTICE:6,GAMETYPE_DOMINATION:7,COLORARRAY:[268435455,4278190208,4278222848,4286578688,4286578816,4286611456,4286611584,4290822336,4278190335,4278255360,4278255615,4294901760,4294902015,4294967040,4290822336,4286611584,4278190080],IT_NONE:0,IT_SHOTGUN:1,IT_GRENADE:2,IT_ROCKET:3,IT_SHAFT:4,IT_RAIL:5,IT_PLASMA:6,IT_BFG:7,IT_AMMO_MACHINEGUN:8,IT_AMMO_SHOTGUN:9,IT_AMMO_GRENADE:10,IT_AMMO_ROCKET:11,IT_AMMO_SHAFT:12,IT_AMMO_RAIL:13,IT_AMMO_PLASMA:14,IT_AMMO_BFG:15,IT_SHARD:16,IT_YELLOW_ARMOR:17,IT_RED_ARMOR:18,IT_HEALTH_5:19,IT_HEALTH_25:20,IT_HEALTH_50:21,IT_HEALTH_100:22,IT_POWERUP_REGENERATION:23,IT_POWERUP_BATTLESUIT:24,IT_POWERUP_HASTE:25,IT_POWERUP_QUAD:26,IT_POWERUP_FLIGHT:27,IT_POWERUP_INVISIBILITY:28,IT_TRIX_GRENADE:29,IT_TRIX_ROCKET:30,IT_LAVA:31,IT_WATER:32,IT_DEATH:33,IT_RESPAWN:34,IT_RED_RESPAWN:35,IT_BLUE_RESPAWN:36,IT_EMPTY:37,IT_JUMPPAD:38,IT_JUMPPAD2:39,IT_BLUE_FLAG:40,IT_RED_FLAG:41,IT_DOMINATION_FLAG:42,DDEMO_VERSION:0,DDEMO_FIREROCKET:1,DDEMO_PLAYERPOS:2,DDEMO_TIMESET:3,DDEMO_CREATEPLAYER:4,DDEMO_KILLOBJECT:5,DDEMO_FIREBFG:6,DDEMO_FIREPLASMA:7,DDEMO_FIREGREN:8,DDEMO_FIRERAIL:9,DDEMO_FIRESHAFT:10,DDEMO_FIRESHOTGUN:11,DDEMO_FIREMACH:12,DDEMO_ITEMDISSAPEAR:13,DDEMO_ITEMAPEAR:14,DDEMO_DAMAGEPLAYER:15,DDEMO_HAUPDATE:16,DDEMO_FLASH:17,DDEMO_JUMPSOUND:18,DDEMO_GAMEEND:19,DDEMO_RESPAWNSOUND:20,DDEMO_JUMPPADSOUND:21,DDEMO_LAVASOUND:22,DDEMO_POWERUPSOUND:23,DDEMO_EARNPOWERUP:24,DDEMO_READYPRESS:25,DDEMO_FLIGHTSOUND:26,DDEMO_EARNREWARD:27,DDEMO_STATS:28,DDEMO_GAMESTATE:29,DDEMO_TRIXARENAEND:30,DDEMO_OBJCHANGESTATE:31,DDEMO_CORPSESPAWN:32,DDEMO_GRENADESYNC:33,DDEMO_STATS2:34,DDEMO_PLAYERPOSV2:35,DDEMO_FIREGRENV2:36,DDEMO_NOAMMOSOUND:37,DDEMO_GAUNTLETSTATE:38,DDEMO_STATS3:39,DDEMO_FIREPLASMAV2:40,DDEMO_PLAYERPOSV3:41,DDEMO_BUBBLE:42,DDEMO_MPSTATE:43,DDEMO_NETRAIL:44,DDEMO_NETPARTICLE:45,DDEMO_NETTIMEUPDATE:46,DDEMO_NETSVMATCHSTART:47,DDEMO_DROPPLAYER:48,DDEMO_CREATEPLAYERV2:49,DDEMO_SPECTATORCONNECT:50,DDEMO_SPECTATORDISCONNECT:51,DDEMO_CHATMESSAGE:52,DDEMO_PLAYERRENAME:53,DDEMO_PLAYERMODELCHANGE:54,DDEMO_GENERICSOUNDDATA:55,DDEMO_GENERICSOUNDSTATDATA:56,DDEMO_TEAMSELECT:57,DDEMO_CTF_EVENT_FLAGTAKEN:58,DDEMO_CTF_EVENT_FLAGCAPTURE:59,DDEMO_CTF_EVENT_FLAGDROP:60,DDEMO_CTF_EVENT_FLAGPICKUP:61,DDEMO_CTF_EVENT_FLAGDROP_APPLY:62,DDEMO_CTF_EVENT_FLAGRETURN:63,DDEMO_CTF_GAMESTATE:64,DDEMO_CTF_EVENT_FLAGDROPGAMESTATE:65,DDEMO_CTF_GAMESTATESCORE:66,DDEMO_CTF_FLAGCARRIER:67,DDEMO_DOM_CAPTURE:68,DDEMO_DOM_SCORECHANGED:69,DDEMO_WPN_EVENT_WEAPONDROP:70,DDEMO_WPN_EVENT_PICKUP:71,DDEMO_WPN_EVENT_WEAPONDROP_APPLY:72,DDEMO_WPN_EVENT_WEAPONDROPGAMESTATE:73,DDEMO_DOM_CAPTUREGAMESTATE:74,DDEMO_NEW_SHAFTBEGIN:75,DDEMO_NEW_SHAFTEND:76,DDEMO_POWERUP_EVENT_POWERUPDROP:77,DDEMO_POWERUP_EVENT_PICKUP:78,DDEMO_POWERUP_EVENT_POWERUPDROPGAMESTATE:79,DDEMO_CTF_EVENT_FLAGTAKEN_RED:80,DDEMO_CTF_EVENT_FLAGCAPTURE_RED:81,DDEMO_CTF_EVENT_FLAGDROP_RED:82,PUV3_DIR0:1,PUV3_DIR1:2,PUV3_DIR2:8,PUV3_DIR3:16,PUV3_DEAD0:32,PUV3_DEAD1:64,PUV3_DEAD2:128,PUV3_WPN0:256,PUV3_WPN1:512,PUV3_WPN2:1024,PUV3_WPN3:2048,PUV3_WPN4:4096,PUV3_WPN5:8192,PUV3_WPN6:16384,PUV3_WPN7:32768,PUV3B_WPN8:1,PUV3B_CROUCH:2,PUV3B_BALLOON:8};document.addEventListener("keydown",function(e){192===e.keyCode&&((a=!a)?(r.classList.add("open"),h.scrollTop=h.scrollHeight,o.value="",o.focus()):r.classList.remove("open"),e.preventDefault())});var a=!1,r=document.getElementById("console"),h=document.getElementById("console-content"),o=document.getElementById("console-input"),n=h.innerHTML;o.addEventListener("keydown",function(e){if(13===e.keyCode){e.preventDefault();var t=o.value.trim();l.writeText(t),0===t.indexOf("map ")?document.location.href="?mapfile="+t.substring(4):"help"===t&&(l.writeText("Available commands:"),l.writeText("help"),l.writeText("map <mapname>")),o.value=""}});var l={writeText(e){e=e.toString(),(n+="<br>"+function(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}(e)).length>5e3&&(n=n.substring(n.length-5e3)),h.innerHTML=n,h.scrollTop=h.scrollHeight}},p=l,d={trunc:Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)},ord:e=>e.charCodeAt(0),random:(e,t)=>Math.floor(Math.random()*(t-e))+e,removeHtmlElement(e){var t=document.getElementById(e);t.parentNode.removeChild(t)},filterNickName(e){for(var t="",s=0;s<e.length;s++)"^"==e[s]?s++:t+=e[s];return t},getDelphiString(e){if(0==e.length)return e;var t=e[0].charCodeAt(0);return t<=e.length-1&&(e=e.substring(1,t+1)),e},getImageDimensions:e=>new Promise(function(t,s){var i=new Image;i.onload=function(){t({w:i.width,h:i.height})},i.src=e}),rectOverlap:(e,t)=>!(e.x1>=t.x2||t.x1>=e.x2||e.y1>=t.y2||t.y1>=e.y2),trimChars(e,t){var s=new RegExp("^["+t+"]+|["+t+"]+$","g");return e.replace(s,"")},bringToFront(e){if(e.parent){var t=e.parent;t.removeChild(e),t.addChild(e)}}};class c{constructor(e,t,s){this.g=e,this.x=t,this.y=s,this.offsetX=0,this.offsetY=0,this.width=i.BRICK_WIDTH,this.height=i.BRICK_HEIGHT,this.animated=!1,this.animationSpeed=.2,this.animateOneTime=!1,this.frameStopped=0,this.frameStart=0,this.frameEnd=0,this.rotation=0,this.texture=null,this.sprite=null,this.anchor=!1,this.bullet=!1,this.overlaps=[],this.container=this.g.render.mapGraphics,this.timerIds=[]}spawn(){if(this.animated){this.sprite=new PIXI.AnimatedSprite(this.texture),this.sprite.animationSpeed=this.animationSpeed,this.sprite.play(),0==this.frameEnd&&(this.frameEnd=this.sprite.totalFrames-1);var e=this;this.sprite.onFrameChange=(t=>{e.animateOneTime&&t==e.frameEnd&&(e.sprite.gotoAndStop(e.frameStopped),e.animateOneTime()),e.sprite.playing&&(0==t&&e.frameStart>0||t==e.frameEnd)&&e.sprite.gotoAndPlay(e.frameStart)})}else null!==this.texture&&(this.sprite=new PIXI.Sprite(this.texture));this.sprite.rotation=this.rotation,this.anchor&&this.sprite.anchor.set(this.anchor),this.setX(this.x),this.setY(this.y),this.container.addChild(this.sprite),this.mech=this.g.render.createMech(0,0,this.width,this.height),this.mech.visible=!1}play(){this.sprite.play()}stop(){this.sprite.gotoAndStop(this.frameStopped)}show(){this.sprite.visible=!0}hide(){this.sprite.visible=!1}visible(){return!this.sprite||this.sprite.visible}setX(e){this.x=e,this.sprite.x=this.x+this.offsetX}setY(e){this.y=e,this.sprite.y=this.y+this.offsetY}fadeOut(e,t){var s=this,i=this.g.timerManager.addTickTimer(1,0,function(i,a){s.sprite.alpha-=e,s.sprite.alpha<=0&&(s.hide(),t())});this.timerIds.push(i)}rect(){return{x1:this.x-this.width*this.sprite.anchor.x+this.g.render.mapDx,y1:this.y-this.height*this.sprite.anchor.y+this.g.render.mapDy,x2:this.x-this.width*this.sprite.anchor.x+this.width+this.g.render.mapDx,y2:this.y-this.height*this.sprite.anchor.y+this.height+this.g.render.mapDy}}handleCollisions(e,t){if(e.dead)return!1;if(!this.visible())return!1;var s=this.overlaps.indexOf(e.DXID);if(d.rectOverlap(this.rect(),e.rect()))return-1==s&&(this.overlaps.push(e.DXID),t(e));-1!=s&&this.overlaps.splice(s,1)}handleBrickCollisions(e,t){if(!this.bullet)return!1;if(!this.visible())return!1;var s=e.col+"_"+e.row+"_"+e.idx,i=this.overlaps.indexOf(s);if(d.rectOverlap(this.rect(),e.rect()))return-1==i&&(this.overlaps.push(s),t(e));-1!=i&&this.overlaps.splice(i,1)}destroy(){for(var e in this.timerIds)this.g.timerManager.removeTimer(e);this.container.removeChild(this.sprite),this.g.config.mech&&this.g.render.removeMech(this.mech)}}class u extends c{constructor(e,t,s){super(e,t,s),this.spawnDelay=0,this.respawnTime=0}spawn(){if(super.spawn(),this.spawnDelay>0){this.sprite.visible=!1;var e=this,t=this.g.timerManager.addTimeout(this.spawnDelay,function(t,s){e.sprite.visible=!0});this.timerIds.push(t)}}handleCollisions(e,t){if(super.handleCollisions(e,t)&&(this.sprite.visible=!1,this.respawnTime>0)){var s=this,i=this.g.timerManager.addTimeout(this.respawnTime,function(e,t){s.sprite.visible=!0});this.timerIds.push(i)}}}var m=s(0),y=s.n(m),g={wpkup:new y.a({urls:["sounds/wpkup.wav"]}),ammopkup:new y.a({urls:["sounds/ammopkup.wav"]}),armor:new y.a({urls:["sounds/armor.wav"]}),shard:new y.a({urls:["sounds/shard.wav"]}),health5:new y.a({urls:["sounds/health5.wav"]}),health25:new y.a({urls:["sounds/health25.wav"]}),health50:new y.a({urls:["sounds/health50.wav"]}),health100:new y.a({urls:["sounds/health100.wav"]}),talk:new y.a({urls:["sounds/talk.wav"]}),expl:new y.a({urls:["sounds/expl.wav"]}),fire_bfg:new y.a({urls:["sounds/bfg_fire.wav"]}),fire_plasma:new y.a({urls:["sounds/plasma.wav"]}),fire_gren:new y.a({urls:["sounds/grenade.wav"]}),fire_rail:new y.a({urls:["sounds/rail.wav"]}),fire_shaft:new y.a({urls:["sounds/lg_hum.wav"]}),fire_shaft_begin:new y.a({urls:["sounds/lg_start.wav"]}),fire_shaft_end:new y.a({urls:["sounds/lg_hum.wav"]}),fire_shotgun:new y.a({urls:["sounds/shotgun.wav"]}),fire_mach:new y.a({urls:["sounds/machine.wav"]}),fire_rocket:new y.a({urls:["sounds/rocket.wav"]}),fire_gauntl0:new y.a({urls:["sounds/gauntl_r1.wavv"]}),fire_gauntl1:new y.a({urls:["sounds/gauntl_r2.wav"]}),fire_gauntl2:new y.a({urls:["sounds/gauntl_a.wav"]}),powerup_invis:new y.a({urls:["sounds/invisibility.wav"]}),powerup_haste:new y.a({urls:["sounds/haste.wav"]}),powerup_quad:new y.a({urls:["sounds/quaddamage.wav"]}),powerup_regen:new y.a({urls:["sounds/regeneration.wav"]}),powerup_battle:new y.a({urls:["sounds/holdable.wav"]}),flagtk:new y.a({urls:["sounds/flagtk.wav"]}),flagret:new y.a({urls:["sounds/flagret.wav"]}),flagcap:new y.a({urls:["sounds/flagcap.wav"]}),jumppad:new y.a({urls:["sounds/jumppad.wav"]}),respawn:new y.a({urls:["sounds/respawn.wav"]}),lava:new y.a({urls:["sounds/lava.wav"]}),powerup:new y.a({urls:["sounds/poweruprespawn.wav"]}),flight:new y.a({urls:["sounds/flight.wav"]}),noammo:new y.a({urls:["sounds/noammo.wav"]}),genericdata:new y.a({urls:["sounds/hit.wav"]}),gameend:new y.a({urls:["sounds/gameend.wav"]}),matchstart:new y.a({urls:["sounds/fight.wav"]}),model_sound_path:"sound/models/",models:{sarge:_("sarge"),xaero:_("xaero"),keel:_("keel"),doom2:_("doom2"),crashed:_("crashed")}};function _(e){return{jump:new y.a({urls:["sounds/models/"+e+"/jump1.wav"]}),death1:new y.a({urls:["sounds/models/"+e+"/death1.wav"]}),death2:new y.a({urls:["sounds/models/"+e+"/death2.wav"]}),death3:new y.a({urls:["sounds/models/"+e+"/death3.wav"]}),pain25:new y.a({urls:["sounds/models/"+e+"/pain25_1.wav"]}),pain50:new y.a({urls:["sounds/models/"+e+"/pain50_1.wav"]}),pain75:new y.a({urls:["sounds/models/"+e+"/pain75_1.wav"]}),pain100:new y.a({urls:["sounds/models/"+e+"/pain100_1.wav"]})}}var D={constructor(){this.volume=1},play(e,t){g[e].volume(this.volume),g[e].play()},playModel(e,t){g.models[e]||(e="sarge"),g.models[e][t].volume(this.volume),0==g.models[e][t].pos()&&g.models[e][t].play()},setVolume(e){this.volume=e},playJump(e){this.playModel(e.model,"jump")},playPain(e){var t=100;e.health<=25?t=25:e.health<=50?t=50:e.health<=75&&(t=75);var s="pain"+t;this.playModel(e.model,s)},playDeath(e){var t="death"+(d.random(1,3)+1);this.playModel(e.model,t)}};class E extends u{constructor(e,t,s){super(e,t,s),this.texture=e.resources.medkits.textures["Medkits-0.png"],this.itemId=i.IT_HEALTH_5,this.respawnTime=30,this.health=5}handleCollisions(e){var t=this;super.handleCollisions(e,function(e){return!(e.health>=100)&&(e.addHealth(t.health,100),D.play("health5"),t.sprite.visible=!1,!0)})}}class w extends u{constructor(e,t,s){super(e,t,s),this.texture=e.resources.medkits.textures["Medkits-1.png"],this.offsetX=-3,this.itemId=i.IT_HEALTH_25,this.respawnTime=30,this.health=25}handleCollisions(e){var t=this;super.handleCollisions(e,function(e){return!(e.health>=100)&&(e.addHealth(t.health,100),D.play("health25"),t.sprite.visible=!1,!0)})}}class f extends u{constructor(e,t,s){super(e,t,s),this.texture=e.resources.medkits.textures["Medkits-2.png"],this.offsetX=-5,this.itemId=i.IT_HEALTH_50,this.respawnTime=30,this.health=50}handleCollisions(e){var t=this;super.handleCollisions(e,function(e){return!(e.health>=100)&&(e.addHealth(t.health,100),D.play("health50"),!0)})}}class T extends u{constructor(e,t,s){super(e,t,s),this.texture=e.resources.mega.spritesheet.animations.mega,this.animated=!0,this.offsetX=7,this.itemId=i.IT_HEALTH_100,this.respawnTime=60,this.health=100}handleCollisions(e){var t=this;super.handleCollisions(e,function(e){return e.addHealth(t.health,200),D.play("health100"),!0})}}class I extends u{constructor(e,t,s){super(e,t,s),this.texture=e.resources.items.textures["item-"+(i.IT_SHARD-1)+".png"],this.itemId=i.IT_SHARD,this.respawnTime=30,this.armor=5}handleCollisions(e){var t=this;super.handleCollisions(e,function(e){return e.addArmor(t.armor),D.play("shard"),!0})}}class P extends u{constructor(e,t,s){super(e,t,s),this.texture=e.resources.armors.spritesheet.animations.armors,this.animated=!0,this.frameStart=0,this.frameEnd=19,this.offsetY=-5,this.itemId=i.IT_YELLOW_ARMOR,this.respawnTime=30,this.armor=50}handleCollisions(e){var t=this;super.handleCollisions(e,function(e){return e.addArmor(t.armor),D.play("armor"),!0})}}class x extends u{constructor(e,t,s){super(e,t,s),this.texture=e.resources.armors.spritesheet.animations.armors,this.animated=!0,this.frameStart=20,this.frameEnd=39,this.offsetY=-5,this.itemId=i.IT_RED_ARMOR,this.respawnTime=30,this.armor=100}handleCollisions(e){var t=this;super.handleCollisions(e,function(e){return e.addArmor(t.armor),D.play("armor"),!0})}}class O extends u{constructor(e,t,s){super(e,t,s),this.texture=e.resources.powerup.spritesheet.animations.quad,this.animated=!0,this.offsetY=-16,this.itemId=i.IT_POWERUP_QUAD,this.spawnDelay=0,this.respawnTime=120}spawn(){super.spawn(),this.hide()}show(){super.show(),D.play("powerup")}handleCollisions(e){var t=this;super.handleCollisions(e,function(e){return e.powerups.push(t.itemId),console.log("player takes quad"),D.play("powerup_quad"),!0})}}class A extends u{constructor(e,t,s){super(e,t,s),this.texture=e.resources.powerup.spritesheet.animations.fly,this.animated=!0,this.offsetY=-16,this.itemId=i.IT_POWERUP_FLIGHT,this.spawnDelay=0,this.respawnTime=120}spawn(){super.spawn(),this.hide()}show(){super.show(),D.play("powerup")}handleCollisions(e){var t=this;super.handleCollisions(e,function(e){return e.powerups.push(t.itemId),!0})}}class M extends u{constructor(e,t,s){super(e,t,s),this.texture=e.resources.powerup.spritesheet.animations.haste,this.animated=!0,this.offsetY=-16,this.itemId=i.IT_POWERUP_HASTE,this.spawnDelay=0,this.respawnTime=120}spawn(){super.spawn(),this.hide()}show(){super.show(),D.play("powerup")}handleCollisions(e){var t=this;super.handleCollisions(e,function(e){return e.powerups.push(t.itemId),D.play("powerup_haste"),!0})}}class v extends u{constructor(e,t,s){super(e,t,s),this.texture=e.resources.powerup.spritesheet.animations.battle,this.animated=!0,this.offsetY=-16,this.itemId=i.IT_POWERUP_BATTLESUIT,this.spawnDelay=0,this.respawnTime=120}spawn(){super.spawn(),this.hide()}show(){super.show(),D.play("powerup")}handleCollisions(e){var t=this;super.handleCollisions(e,function(e){return e.powerups.push(t.itemId),D.play("powerup_battle"),!0})}}class b extends u{constructor(e,t,s){super(e,t,s),this.texture=e.resources.powerup.spritesheet.animations.invis,this.animated=!0,this.offsetY=-16,this.itemId=i.IT_POWERUP_INVISIBILITY,this.spawnDelay=120,this.respawnTime=120}spawn(){super.spawn(),this.hide()}show(){super.show(),D.play("powerup")}handleCollisions(e){var t=this;super.handleCollisions(e,function(e){return e.powerups.push(t.itemId),D.play("powerup_invis"),!0})}}class C extends u{constructor(e,t,s){super(e,t,s),this.texture=e.resources.powerup.spritesheet.animations.invis,this.animated=!0,this.offsetY=-16,this.itemId=i.IT_POWERUP_REGENERATION,this.spawnDelay=0,this.respawnTime=120}spawn(){super.spawn(),this.hide()}show(){super.show(),D.play("powerup")}handleCollisions(e){var t=this;super.handleCollisions(e,function(e){return e.powerups.push(t.itemId),D.play("powerup_regen"),!0})}}class R extends u{constructor(e,t,s,i){super(e,t,s),this.texture=e.resources.items.textures["item-"+(i-1)+".png"],this.itemId=i,this.respawnTime=30}handleCollisions(e){var t=this;super.handleCollisions(e,function(e){return e.addWeapon(t.itemId),D.play("wpkup"),t.sprite.visible=!1,!0})}}class k extends c{constructor(e,t,s){super(e,t,s),this.g=e,this.initX=t,this.initY=s,this.texture=e.resources.flag.spritesheet.animations.flag,this.animated=!0,this.frameStart=14,this.frameEnd=27,this.offsetY-=26,this.itemId=i.IT_RED_FLAG}returnToBase(){for(var e=0;e<this.g.players.length;e++)this.g.players[e].flag&&this.g.players[e].flag.itemId==this.itemId&&(this.g.players[e].flag=null);this.setX(this.initX),this.setY(this.initY),this.sprite.scale.x=1,this.sprite.angle=0}handleCollisions(e){super.handleCollisions(e,function(e){return!1})}}class S extends c{constructor(e,t,s){super(e,t,s),this.initX=t,this.initY=s,this.texture=e.resources.flag.spritesheet.animations.flag,this.animated=!0,this.frameStart=0,this.frameEnd=13,this.offsetY-=26,this.itemId=i.IT_BLUE_FLAG}returnToBase(){for(var e=0;e<this.g.players.length;e++)this.g.players[e].flag&&this.g.players[e].flag.itemId==this.itemId&&(this.g.players[e].flag=null);this.setX(this.initX),this.setY(this.initY),this.sprite.scale.x=1,this.sprite.angle=0}handleCollisions(e){super.handleCollisions(e,function(e){return!1})}}class N extends c{constructor(e,t,s,a){super(e,t,s),this.texture=e.resources.jumppad.spritesheet.animations.jumppad,this.animated=!0,this.itemId=a?i.IT_JUMPPAD2:i.IT_JUMPPAD,this.strong=a}handleCollisions(e){super.handleCollisions(e,function(e){return D.play("jumppad"),!1})}}class U extends c{constructor(e,t,s){super(e,t,s)}handleCollisions(e,t){return super.handleCollisions(e,t)}}class L extends U{constructor(e,t,s){super(e,t,s),this.texture=e.resources.portal.texture,this.offsetX=-16,this.offsetY=-32}handleCollisions(e){super.handleCollisions(e,function(e){return!1})}}class H{constructor(e){this.g=e,this.rows=0,this.cols=0,this.bricks=[],this.brickObjects=[],this.specialObjects=[],this.respawns=[],this.bg=1,this.paletteImage="images/palette.png",this.paletteIndex=6,this.paletteCustomImage=null,this.paletteCustomIndex=54}async loadFromDemo(e){this.bg=e.Header.BG,0==this.bg&&(this.bg=this.g.config.default_bg),this.loadNFKMap(e.Bricks),e.PaletteBytes&&(this.paletteCustomImage="data:image/png;base64,"+e.PaletteBytes,await this.g.render.updatePaletteTexture(this.paletteCustomImage)),this.specialObjects=e.Objects}loadNFKMap(e){var t=e;this.rows=t.length;for(var s=0;s<t.length;s++){this.bricks[s]=[];var i=window.atob(t[s]);this.cols=i.length;for(var a=0;a<i.length;a++){var r=d.ord(i[a]);this.bricks[s][a]=r,34!=r&&35!=r&&36!=r||this.respawns.push({row:a,col:s})}}}spawnObjects(){this._destroyObjects();for(var e=0;e<this.g.map.bricks.length;e++)for(var t=0;t<this.g.map.bricks[e].length;t++){var s=this.g.map.bricks[e][t],a=e*i.BRICK_WIDTH,r=t*i.BRICK_HEIGHT;if(!(this.g.map.bricks[e][t]>53)){if(s>=i.IT_SHOTGUN&&s<=i.IT_BFG&&this.g.objects.push(new R(this.g,a,r,s)),s>=i.IT_AMMO_MACHINEGUN&&s<=i.IT_AMMO_BFG){s==i.IT_AMMO_MACHINEGUN&&100,s==i.IT_AMMO_PLASMA&&50,this.g.objects.push(new R(this.g,a,r,s,10))}s==i.IT_SHARD&&this.g.objects.push(new I(this.g,a,r)),s==i.IT_YELLOW_ARMOR&&this.g.objects.push(new P(this.g,a,r)),s==i.IT_RED_ARMOR&&this.g.objects.push(new x(this.g,a,r)),s==i.IT_HEALTH_5&&this.g.objects.push(new E(this.g,a,r)),s==i.IT_HEALTH_25&&this.g.objects.push(new w(this.g,a,r)),s==i.IT_HEALTH_50&&this.g.objects.push(new f(this.g,a,r)),s==i.IT_HEALTH_100&&this.g.objects.push(new T(this.g,a,r)),s==i.IT_POWERUP_REGENERATION&&this.g.objects.push(new C(this.g,a,r)),s==i.IT_POWERUP_BATTLESUIT&&this.g.objects.push(new v(this.g,a,r)),s==i.IT_POWERUP_HASTE&&this.g.objects.push(new M(this.g,a,r)),s==i.IT_POWERUP_QUAD&&this.g.objects.push(new O(this.g,a,r)),s==i.IT_POWERUP_FLIGHT&&this.g.objects.push(new A(this.g,a,r)),s==i.IT_POWERUP_INVISIBILITY&&this.g.objects.push(new b(this.g,a,r)),s==i.IT_JUMPPAD&&this.g.objects.push(new N(this.g,a,r,!1)),s==i.IT_JUMPPAD2&&this.g.objects.push(new N(this.g,a,r,!0)),s==i.IT_BLUE_FLAG&&this.g.objects.push(new S(this.g,a,r)),s==i.IT_RED_FLAG&&this.g.objects.push(new k(this.g,a,r))}}for(var h=0;h<this.specialObjects.length;h++){var o=this.specialObjects[h];a=o.x*i.BRICK_WIDTH,r=o.y*i.BRICK_HEIGHT;1==o.objtype&&this.g.objects.push(new L(this.g,a,r))}for(h=0;h<this.g.objects.length;h++)this.g.objects[h].spawn();console.log("spawned "+this.g.objects.length+" objects")}_destroyObjects(){for(var e=0;e<this.g.objects.length;e++)this.g.objects[e].destroy();this.g.objects=[],console.log("destroy objects")}destroyBrickObjects(){for(var e=0;e<this.brickObjects.length;e++)this.g.render.mapGraphics(this.sprite),this.g.render.removeMech(this.mech),this.brickObjects[e].sprite.destroy(),this.brickObjects[e].mech.destroy();this.brickObjects=[]}isBrick(e,t){return e>=this.rows||t>=this.cols||e<0||t<0||this.bricks[e][t]>53}getBrick(e,t){return this.bricks[e][t]}brickRect(e,t){return{x1:t*i.BRICK_WIDTH+this.g.render.mapDx,y1:e*i.BRICK_HEIGHT+this.g.render.mapDy,x2:t*i.BRICK_WIDTH+i.BRICK_WIDTH+this.g.render.mapDx,y2:e*i.BRICK_HEIGHT+i.BRICK_HEIGHT+this.g.render.mapDy}}getRows(){return this.cols}getCols(){return this.rows}getRandomRespawn(){return this.respawns[d.random(0,respawns.length)]}}var B={keyUp:!1,keyDown:!1,keyLeft:!1,keyRight:!1,keyTab:!1,onKeyUp:function(e,t){j.push({event:"keyup",keyCode:e,f:t})}},j=[];document.addEventListener("keydown",e=>{if("textarea"!==e.target.nodeName.toLowerCase()){switch(e.preventDefault(),e.keyCode){case 38:B.keyUp=!0;break;case 37:B.keyLeft=!0;break;case 39:B.keyRight=!0;break;case 40:B.keyDown=!0;break;case 9:B.keyTab=!0}for(var t=0;t<j.length;t++)"keydown"==j[t].event&&e.keyCode==j[t].keyCode&&j[t].f()}}),document.addEventListener("keyup",e=>{if("textarea"!==e.target.nodeName.toLowerCase()){switch(e.preventDefault(),e.keyCode){case 38:B.keyUp=!1;break;case 37:B.keyLeft=!1;break;case 39:B.keyRight=!1;break;case 40:B.keyDown=!1;break;case 9:B.keyTab=!1}for(var t=0;t<j.length;t++)"keyup"==j[t].event&&e.keyCode==j[t].keyCode&&j[t].f()}});var G=B,W=s(1),F=s.n(W);class V extends c{constructor(e,t,s,i,a){super(e,0,0),this.texture=e.resources[s].spritesheet.animations[s+"/"+a+i],this.animated=!0,this.frameStart=1,this.container=t,this.spawn(),this.sprite.anchor.set(.5),this.sprite.animationSpeed=.3}handleCollisions(e){return!1}}class X{constructor(e,t){this.g=e,this.stage=e.render.stage,this.player=t,this.container=new F.a.Container,console.log("c1",this.container),this.stage.addChild(this.container),this.obj=null,this.animations=this.g.initPlayerModels(this.container),this.updateModel(),this.playerPowerup=new F.a.Text(t.displayName,{fontFamily:"Arial",fontSize:14,fontWeight:"bold",fill:"red",align:"center"}),this.playerPowerup.anchor=new F.a.Point(.5,.5),this.playerPowerup.y-=64,this.container.addChild(this.playerPowerup),this.playerName=new F.a.Text(t.displayName,{fontFamily:"Arial",fontSize:14,fill:"white",align:"center"}),this.playerName.anchor=new F.a.Point(.5,.5),this.playerName.y-=50,this.container.addChild(this.playerName),this.playerHA=new F.a.Text("0 / 0",{fontFamily:"Arial",fontSize:12,fill:"white",align:"center"}),this.playerHA.anchor=new F.a.Point(.5,.5),this.playerHA.y-=36,this.container.addChild(this.playerHA),this.mech=this.g.render.createMech(0,0,this.player.width(),this.player.height()),this.mech.visible=!1}getWeaponTexture(e){return 0==e?this.g.resources.gaunlet.textures[0]:1==e?this.g.resources.mgun.textures[0]:this.g.resources.weapons.textures[e]}updateModel(){for(var e in this.animations)for(var t in this.animations[e])for(var s=0;s<this.animations[e][t].length;s++)this.animations[e][t][s].sprite.visible=!1;var i=this.player.crouch?1:0;this.player.dead>0&&(i=2,console.log("dead "+i)),this.obj=this.animations[this.player.model][this.player.modelColor][i].sprite,this.obj.visible=!0,this.play()}play(){this.obj.playing||this.obj.gotoAndPlay(0)}stop(){this.obj.playing&&this.obj.gotoAndStop(0)}adjustPosition(e,t){this.player.dir==i.DIR_LS||this.player.dir==i.DIR_RS?this.stop():this.play(),this.container.scale.x=this.player.dir==i.DIR_LS||this.player.dir==i.DIR_LW?-1:1,this.playerName.scale.x=this.playerHA.scale.x=this.playerPowerup.scale.x=this.container.scale.x,this.container.x=e,this.player.crouch&&(t+=5),this.container.y=t,this.playerHA.text=this.player.health+" / "+this.player.armor,this.setPowerupString(),this.player.weapon.sprite.angle=this.player.fangle,this.player.flag&&(this.player.flag.setY(this.player.y),this.player.dir==i.DIR_RW||this.player.dir==i.DIR_RS?(this.player.flag.setX(this.player.x-20),this.player.flag.sprite.scale.x=-1,this.player.flag.sprite.angle=-45):(this.player.flag.setX(this.player.x+20),this.player.flag.sprite.scale.x=1,this.player.flag.sprite.angle=45))}updatePlayerHA(e,t,s){}setPowerupString(){if(0!=this.player.powerups.length){var e="[";for(var t in this.player.powerups){switch(this.player.powerups[t]){case i.IT_POWERUP_REGENERATION:e+="REGENERATION";break;case i.IT_POWERUP_BATTLESUIT:e+="BATTLESUIT";break;case i.IT_POWERUP_HASTE:e+="HASTE";break;case i.IT_POWERUP_QUAD:e+="QUAD";break;case i.IT_POWERUP_FLIGHT:e+="FLIGHT";break;case i.IT_POWERUP_INVISIBILITY:e+="INVISIBILITY"}e+=" |"}e=d.trimChars(e," |"),e+="]",this.playerPowerup.text=e}else this.playerPowerup.text=""}destroy(){this.stage.removeChild(this.obj),this.stage.removeChild(this.playerCenter),this.stage.removeChild(this.playerName),this.stage.removeChild(this.playerHA),this.stage.removeChild(this.mech)}}const Y=i.PLAYER_MAX_VELOCITY_X;var K=d.trunc,J=0,z=document.getElementById("log"),q="";class Q{constructor(e,t){this.g=e,this.player=t,this.map=e.map,this.defx=0,this.defy=0,this.tmpCol=0,this.tmpY=0,this.tmpSpeedX=0,this.tmpAbsMaxVelocityX=0,this.tmpSign=0,this.velocityYSpeedJump=[0,0,.4,.8,1,1.2,1.4],this.velocityXSpeedJump=[0,.33,.8,1.1,1.4,1.8,2.2],this.tmpLastWasJump=!1,this.tmpCurJump=!1,this.speedJumpDirection=0,this.tmpLastKeyUp=!1,this.tmpDjBonus=0,this.time=0,this.tmpDeltaTime=0,this.tmpDeltaPhysicFrames=0}playerphysic(e){this.defx=this.player.x,this.defy=this.player.y,this.player.velocityY=this.player.velocityY+.056,this.player.velocityY>-1&&this.player.velocityY<0&&(this.player.velocityY/=1.11),this.player.velocityY>0&&this.player.velocityY<5&&(this.player.velocityY*=1.1),this.player.velocityX<-.2||this.player.velocityX>.2?this.player.keyLeft===this.player.keyRight&&(this.player.isOnGround()?this.player.velocityX/=1.14:this.player.velocityX/=1.025):this.player.velocityX=0,0!==this.player.velocityX?this.tmpSpeedX=(this.player.velocityX<0?-1:1)*this.velocityXSpeedJump[this.player.speedJump]:this.tmpSpeedX=0,this.player.setXY(this.player.x+this.player.velocityX+this.tmpSpeedX,this.player.y+this.player.velocityY),this.player.crouch&&(this.player.isOnGround()&&(this.player.isBrickCrouchOnHead()||this.player.velocityY>0)?(this.player.velocityY=0,this.player.setY(16*K(Math.round(this.player.y)/16)+8)):this.player.isBrickCrouchOnHead()&&this.player.velocityY<0&&(this.player.velocityY=0,this.player.doublejumpCountdown=3,this.player.setY(16*K(Math.round(this.player.y)/16)+8))),0!=this.player.velocityX&&(this.tmpCol=K(Math.round(this.defx+(this.player.velocityX<0?-11:11))/32),this.tmpY=this.player.crouch?this.player.y:this.defy,(this.map.isBrick(this.tmpCol,K(Math.round(this.tmpY-(this.player.crouch?8:16))/16))||this.map.isBrick(this.tmpCol,K(Math.round(this.tmpY)/16))||this.map.isBrick(this.tmpCol,K(Math.round(this.tmpY+16)/16)))&&(this.player.setX(32*K(this.defx/32)+(this.player.velocityX<0?9:22)),this.player.velocityX=0,this.player.speedJump=0,this.defx!=this.player.x&&this.log("wall",this.player))),this.player.isOnGround()&&(this.player.isBrickOnHead()||this.player.velocityY>0)?(this.player.velocityY=0,this.player.setY(16*K(Math.round(this.player.y)/16)+8)):e.isBrickOnHead()&&this.player.velocityY<0&&(this.player.velocityY=0,this.player.doublejumpCountdown=3),this.player.velocityX<-5&&(this.player.velocityX=-5),this.player.velocityX>5&&(this.player.velocityX=5),this.player.velocityY<-5&&(this.player.velocityY=-5),this.player.velocityY>5&&(this.player.velocityY=5)}playermove(){if(this.playerphysic(this.player),this.player.doublejumpCountdown>0&&this.player.doublejumpCountdown--,this.player.isOnGround()&&(this.player.velocityY=0),!this.g.demo&&(this.tmpCurJump=!1,this.player.speedJump>0&&(this.player.keyUp!==this.tmpLastKeyUp||this.player.keyLeft&&-1!==this.speedJumpDirection||this.player.keyRight&&1!==this.speedJumpDirection)&&(this.player.speedJump=0,this.log("sj 0 - change keys",this.player)),this.tmpLastKeyUp=this.player.keyUp,this.player.keyUp?!this.player.isOnGround()||this.player.isBrickOnHead()||this.tmpLastWasJump||(this.player.doublejumpCountdown>4&&this.player.doublejumpCountdown<11?(this.player.doublejumpCountdown=14,this.player.velocityY=-3,0!==this.player.velocityX?this.tmpSpeedX=Math.abs(this.player.velocityX)+this.velocityXSpeedJump[this.player.speedJump]:this.tmpSpeedX=0,this.tmpSpeedX>3?(this.tmpDjBonus=this.tmpSpeedX-3,this.player.velocityY-=this.tmpDjBonus,this.log("dj higher (bonus +"+this.round(this.tmpDjBonus)+")",this.player)):this.log("dj standart",this.player),this.player.setCrouch(!1),D.jump()):(0===this.player.doublejumpCountdown&&(this.player.doublejumpCountdown=14,D.jump()),this.player.velocityY=-2.9,this.player.velocityY+=this.velocityYSpeedJump[this.player.speedJump],this.log("jump",player),this.player.speedJump<6&&!this.tmpLastWasJump&&this.player.keyLeft!==this.player.keyRight&&(this.speedJumpDirection=this.player.keyLeft?-1:1,this.player.speedJump++,this.log("increase sj",this.player))),this.tmpCurJump=!0):this.player.isOnGround()&&this.player.speedJump>0&&!this.player.keyDown&&(this.player.speedJump=0,this.log("sj 0 - on ground",this.player)),!this.player.keyUp&&this.player.keyDown?this.player.isOnGround()?this.player.setCrouch(!0):this.player.isBrickCrouchOnHead()||this.player.setCrouch(!1):this.player.setCrouch(this.player.isOnGround()&&this.player.isBrickCrouchOnHead()),this.tmpLastWasJump=this.tmpCurJump,this.player.keyLeft!==this.player.keyRight)){this.tmpAbsMaxVelocityX=Y,this.player.crouch&&this.tmpAbsMaxVelocityX--,this.tmpSign=this.player.keyLeft?-1:1,this.player.velocityX*this.tmpSign<0&&(this.player.velocityX+=.8*this.tmpSign);var e=Math.abs(this.player.velocityX);e<this.tmpAbsMaxVelocityX?this.player.velocityX+=.35*this.tmpSign:e>this.tmpAbsMaxVelocityX&&(this.player.velocityX=this.tmpSign*this.tmpAbsMaxVelocityX)}}runPhysicsOneFrame(e){this.playermove()}updateGame(e){if(0===this.time&&(this.time=e-16),this.tmpDeltaTime=e-this.time,this.tmpDeltaPhysicFrames=K(this.tmpDeltaTime/16),0===this.tmpDeltaPhysicFrames)return!1;if(this.time+=16.6*this.tmpDeltaPhysicFrames,1===this.tmpDeltaPhysicFrames)this.runPhysicsOneFrame();else for(;this.tmpDeltaPhysicFrames>0;)this.runPhysicsOneFrame(),this.tmpDeltaPhysicFrames--}log(e){J++,0!==this.player.velocityX?this.tmpSpeedX=(this.player.velocityX<0?-1:1)*this.velocityXSpeedJump[pthis.layer.speedJump]:this.tmpSpeedX=0,q=J+" "+e+" (x: "+this.round(this.player.x)+", y: "+this.round(this.player.y)+", dx: "+this.round(this.tmpSpeedX)+", dy: "+this.round(this.player.velocityY)+", sj: "+this.player.speedJump+")",z.value=q+"\n"+z.value.substring(0,1e3)}round(e){return K(e)+"."+Math.abs(K(10*e)-10*K(e))}}class $ extends c{constructor(e,t,s,a){super(e,s,a),this.player=t,this.DXID=d.random(1,9999999),this.inertialX=0,this.inertialY=0,this.speed=0,this.dir=i.DIR_RS,this.anchor=.5,this.explosion=null}spawn(){if(super.spawn(),this.g.objects.push(this),this.sprite.scale.x*=this.dir==i.DIR_LS?-1:1,this.bullet){var e=this,t=this.g.timerManager.addTickTimer(1,0,function(t,s){var a=e.x+e.speed*Math.cos(e.rotation),r=e.y+e.speed*Math.sin(e.rotation);e.dir==i.DIR_LS&&(a=e.x-e.speed*Math.cos(e.rotation)),e.setX(a),e.setY(r)});this.timerIds.push(t)}}handleCollisions(e){if(!this.bullet)return!1;var t=this;return super.handleCollisions(e,function(e){return t.player.DXID!=e.DXID&&(t.explode(),t.destroy(),!0)})}handleBrickCollisions(e){if(!this.bullet)return!1;var t=this;return super.handleCollisions(e,function(e){return t.explode(),t.destroy(),!0})}explode(){if(this.explosion){this.expl=new c(this.g,this.x,this.y),this.expl.texture=this.explosion,this.expl.animated=!0,this.expl.animationSpeed=.3,this.expl.anchor=.5;var e=this;this.expl.animateOneTime=function(){e.expl.destroy()},this.expl.spawn()}}destroy(){super.destroy();for(var e=0;e<this.g.objects.length;e++)if(this.g.objects[e].DXID==this.DXID){this.g.objects.splice(e,1);break}}}class Z extends c{constructor(e,t){super(e,0,0),this.g=e,this.player=t,this.offsetX=-1,this.offsetY=-6,this.bullet="",this.ammo=0,this.maxAmmo=0}spawn(){super.spawn(),this.sprite.anchor.set(.35,.5)}addAmmo(e){this.ammo+=e,this.ammo>this.maxAmmo&&(this.ammo=this.maxAmmo)}handleCollisions(e,t){return!1}fire(e,t,s,i){this.newBullet&&this.newBullet(e,t,s,i).spawn()}fireVector(e,t,s,i,a,r){this.newBullet&&this.newBullet(e,t,s,i,a,r).spawn()}}class ee extends Z{constructor(e,t){super(e,t),this.itemId=i.C_WPN_GAUNTLET,this.offsetX=-1,this.texture=e.resources.gauntlet.spritesheet.animations.gauntlet,this.animated=!0,this.frameStopped=0,this.frameStart=1,this.frameEnd=3,this.container=t.graphics.container,this.offsetX=-8}use(e){this.play(),console.log(e),D.play("fire_gauntl"+e)}}class te extends Z{constructor(e,t){super(e,t),this.itemId=i.C_WPN_MACHINE,this.ammo=100,this.maxAmmo=100,this.texture=e.resources.mgun.spritesheet.animations.mgun,this.animated=!0,this.animateOneTime=(()=>{}),this.container=t.graphics.container}newBullet(e,t,s,i,a,r){return new se(this.g,this.player,e,t)}fireVector(e,t,s,i,a,r){super.fireVector(e,t,s,i,a,r),D.play("fire_mach"),this.sprite.play()}}class se extends ${constructor(e,t,s,i){super(e,t,s,i),this.width=this.height=16,this.texture=e.resources.bullets.spritesheet.animations.tile,this.animated=!0,this.animationSpeed=.05,this.frameStart=0,this.frameEnd=2;var a=this;this.animateOneTime=function(){a.destroy()}}}class ie extends Z{constructor(e,t){super(e,t),this.itemId=i.C_WPN_SHOTGUN,this.ammo=10,this.maxAmmo=50,this.texture=e.resources.weapons.textures["weapons-"+(this.itemId-2)+".png"],this.container=t.graphics.container}newBullet(e,t,s,i,a,r){return new ae(this.g,this.player,e,t)}fireVector(e,t,s,i,a,r){super.fireVector(e,t,s,i,a,r),D.play("fire_shotgun")}}class ae extends ${constructor(e,t,s,i){super(e,t,s,i),this.width=this.height=16,this.texture=e.resources.bullets.spritesheet.animations.tile,this.animated=!0,this.animationSpeed=.05,this.frameStart=0,this.frameEnd=2;var a=this;this.animateOneTime=function(){a.destroy()}}}class re extends Z{constructor(e,t){super(e,t),this.itemId=i.C_WPN_GRENADE,this.ammo=10,this.maxAmmo=50,this.texture=e.resources.weapons.textures["weapons-"+(this.itemId-2)+".png"],this.container=t.graphics.container}fireVector(e,t,s,i){D.play("fire_gren"),super.fire(e,t,s,i)}}class he extends Z{constructor(e,t){super(e,t),this.itemId=i.C_WPN_ROCKET,this.ammo=10,this.maxAmmo=50,this.texture=e.resources.weapons.textures["weapons-"+(this.itemId-2)+".png"],this.container=t.graphics.container}newBullet(e,t,s,i){return new oe(this.g,this.player,e,t,s,i)}fire(e,t,s,i){super.fire(e,t,s,i),D.play("fire_rocket")}}class oe extends ${constructor(e,t,s,a,r,h){super(e,t,s,a),this.g=e,this.bullet=!0,this.inertialX=r,this.inertialY=h,this.width=13,this.height=7,this.rotation=t.weapon.sprite.rotation,t.dir!=i.DIR_LS&&t.dir!=i.DIR_LW||(this.dir=i.DIR_LS),this.speed=6,this.texture=e.resources.bullets.textures["tile005.png"],this.explosion=e.resources.explosion.spritesheet.animations.explosion}spawn(){super.spawn(),this.glow=new c(this.g,0,0),this.glow.anchor=.5,this.glow.offsetX=-8,this.glow.texture=this.g.resources.glow.texture,this.glow.container=this.sprite,this.glow.spawn()}}class ne extends Z{constructor(e,t){super(e,t),this.g=e,this.itemId=i.C_WPN_SHAFT,this.ammo=10,this.maxAmmo=50,this.texture=e.resources.weapons.textures["weapons-"+(this.itemId-2)+".png"],this.container=t.graphics.container}spawn(){super.spawn();var e=new PIXI.Graphics;e.lineStyle(3,16777215),e.moveTo(20,0),e.lineTo(150,0),e.endFill(),this.fireObject=new c(this.g,0,0),this.fireObject.sprite=e,this.fireObject.container=this.sprite,this.fireObject.spawn(),this.fireObject.hide()}fire(e){this.fireObject.show(),D.play("fire_shaft_begin")}stop(){this.fireObject.hide(),D.play("fire_shaft_end")}}class le extends Z{constructor(e,t){super(e,t),this.itemId=i.C_WPN_RAIL,this.ammo=10,this.maxAmmo=50,this.texture=e.resources.weapons.textures["weapons-"+(this.itemId-2)+".png"],this.container=t.graphics.container}newBullet(e,t,s,i,a,r){return new pe(this.g,this.player,e,t,a,r)}fireVector(e,t,s,i,a,r){super.fireVector(e,t,s,i,a,r),D.play("fire_rail")}}class pe extends ${constructor(e,t,s,i,a,r){super(e,t,a,r),this.srcX=s,this.srcY=i,this.width=this.height=16,this.texture=e.resources.railhit.texture;var h=this;this.fadeOut(.01,function(){h.destroy()})}spawn(){super.spawn();var e=new PIXI.Graphics;e.lineStyle(2,16777215),e.moveTo(this.srcX,this.srcY),e.lineTo(this.x,this.y),e.endFill(),this.fireObject=new c(this.g,0,0),this.fireObject.sprite=e,this.fireObject.spawn();var t=this;this.fireObject.fadeOut(.08,function(){t.fireObject.destroy()})}}class de extends Z{constructor(e,t){super(e,t),this.itemId=i.C_WPN_PLASMA,this.ammo=10,this.maxAmmo=50,this.texture=e.resources.weapons.textures["weapons-"+(this.itemId-2)+".png"],this.container=t.graphics.container}newBullet(e,t,s,i){return new ce(this.g,this.player,e,t,s,i)}fire(e,t,s,i){super.fire(e,t,s,i),D.play("fire_plasma")}}class ce extends ${constructor(e,t,s,a,r,h){super(e,t,s,a),this.bullet=!0,this.inertialX=r,this.inertialY=h,this.width=this.height=3,this.rotation=t.weapon.sprite.rotation,t.dir!=i.DIR_LS&&t.dir!=i.DIR_LW||(this.dir=i.DIR_LS),this.speed=6,this.texture=e.resources.bullets.textures["tile007.png"]}}class ue extends Z{constructor(e,t){super(e,t),this.itemId=i.C_WPN_BFG,this.ammo=10,this.maxAmmo=50,this.texture=e.resources.weapons.textures["weapons-"+(this.itemId-2)+".png"],this.container=t.graphics.container}newBullet(e,t,s,i){return new me(this.g,this.player,e,t,s,i)}fire(e,t,s,i){super.fire(e,t,s,i),D.play("fire_bfg")}}class me extends ${constructor(e,t,s,a,r,h){super(e,t,s,a),this.g=e,this.bullet=!0,this.inertialX=r,this.inertialY=h,this.width=13,this.height=7,this.rotation=t.weapon.sprite.rotation,t.dir!=i.DIR_LS&&t.dir!=i.DIR_LW||(this.dir=i.DIR_LS),this.speed=6,this.texture=e.resources.bullets.textures["tile015.png"],this.explosion=e.resources.explosion.spritesheet.animations.explosion}spawn(){super.spawn(),this.glow=new c(this.g,0,0),this.glow.anchor=.5,this.glow.offsetX=-8,this.glow.texture=this.g.resources.glow.texture,this.glow.container=this.sprite,this.glow.spawn()}}class ye{constructor(e,t,s){for(var a in this.g=e,this.stage=e.render.stage,this.map=e.map,this.DXID=t,this.x=0,this.y=0,this.name=s,this.displayName=d.filterNickName(s),this.health=0,this.armor=0,this.frags=0,this.ping="0",this.follow=!1,this.velocityX=0,this.velocityY=0,this.crouch=!1,this.dir=i.DIR_RS,this.dead=0,this.BALLOON=!1,this.team=i.C_TEAMNON,this.model="sarge",this.modelColor="default",this.rewardtime=0,this.fangle=0,this.ammo_mg=100,this.ammo_sg=0,this.ammo_gl=0,this.ammo_rl=0,this.ammo_sh=0,this.ammo_rg=0,this.ammo_pl=0,this.ammo_bfg=0,this.keyUp=!1,this.keyDown=!1,this.keyLeft=!1,this.keyRight=!1,this.doublejumpCountdown=0,this.cacheOnGround=!1,this.cacheBrickOnHead=!1,this.cacheBrickCrouchOnHead=!1,this.speedJump=0,this.graphics=null,this.physics=null,this.flag=null,this._init(),this.powerups=[],this.weapons=[new ee(this.g,this),new te(this.g,this),new ie(this.g,this),new re(this.g,this),new he(this.g,this),new ne(this.g,this),new le(this.g,this),new de(this.g,this),new ue(this.g,this)],this.weapon=this.weapons[0],this.weapons)this.weapons[a].spawn()}_init(){this.graphics=new X(this.g,this),this.physics=new Q(this.g,this)}height(){return this.crouch?i.PLAYER_HEIGHT_CROUCH:i.PLAYER_HEIGHT}width(){return i.PLAYER_WIDTH}rect(){return{x1:this.x-this.width()/2+this.g.render.mapDx,y1:this.y-this.height()/2+this.g.render.mapDy+1+(this.crouch?i.BRICK_HEIGHT/2:0),x2:this.x+this.width()/2+this.g.render.mapDx,y2:this.y+this.height()/2+this.g.render.mapDy+1+(this.crouch?i.BRICK_HEIGHT/2:0)}}setModel(e,t){this.model=e,this.modelColor=t,this.graphics.animations[this.model]||(this.model="sarge",console.log("reset model (model not found "+e+")")),this.graphics.animations[this.model][this.modelColor]||(this.modelColor="default",console.log("reset color (model not found "+e+"+"+t+")")),this.graphics.updateModel()}addHealth(e,t){this.health+=e,this.health>t&&(this.health=t),this.health<=0&&this.setDead(1)}addArmor(e){this.admor+=e,this.admor>200&&(this.admor=200)}addWeapon(e){}addWeaponAmmo(e,t){}setWeapon(e){for(var t in this.weapons)this.weapons[t].hide();this.weapon=this.weapons[e],0==this.dead&&this.weapon.show()}setCrouch(e){this.crouch!=e&&(this.crouch=e,this.graphics.updateModel())}setDead(e){this.dead!=e&&(this.dead=e,this.graphics.updateModel(),this.dead>0&&(D.playDeath(this),this.weapon.hide()),this.flag&&(this.flag.setY(this.flag.rect().y+16),this.flag=null),this.powerups=[])}changeTeam(e){console.log("player "+this.name+" selected team "+e),this.team=e,this.setModel(this.model,e==i.C_TEAMRED?"red":e==i.C_TEAMBLUE?"blue":i.C_TEAMNON),this.graphics.updateModel()}setX(e){e!=this.x&&(this.x=e,this.updateCaches())}setY(e){e!=this.y&&(this.y=e,this.updateCaches())}setXY(e,t){e===this.x&&t===this.y||(this.x=e,this.y=t,this.updateCaches())}jump(){D.playModel(this.model,"jump")}updateCaches(){this.updateCacheOnGround(),this.updateCacheBrickOnHead(),this.updateCacheBrickCrouchOnHead()}updateCacheOnGround(){this.cacheOnGround=this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y+25)/16))&&!this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y+23)/16))||this.map.isBrick(d.trunc(d.trunc(this.x+9)/32),d.trunc(d.trunc(this.y+25)/16))&&!this.map.isBrick(d.trunc(d.trunc(this.x+9)/32),d.trunc(d.trunc(this.y+23)/16))||this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y+24)/16))&&!this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y+8)/16))||this.map.isBrick(d.trunc((this.x+9)/32),d.trunc((this.y+24)/16))&&!this.map.isBrick(d.trunc((this.x+9)/32),d.trunc((this.y+8)/16))}updateCacheBrickCrouchOnHead(){this.cacheBrickCrouchOnHead=this.map.isBrick(d.trunc((this.x-8)/32),d.trunc((this.y-9)/16))&&!this.map.isBrick(d.trunc((this.x-8)/32),d.trunc((this.y-7)/16))||this.map.isBrick(d.trunc((this.x+8)/32),d.trunc((this.y-9)/16))&&!this.map.isBrick(d.trunc((this.x+8)/32),d.trunc((this.y-7)/16))||this.map.isBrick(d.trunc((this.x-8)/32),d.trunc((this.y-23)/16))||this.map.isBrick(d.trunc((this.x+8)/32),d.trunc((this.y-23)/16))||this.map.isBrick(d.trunc((this.x-8)/32),d.trunc((this.y-16)/16))||this.map.isBrick(d.trunc((this.x+8)/32),d.trunc((this.y-16)/16))}updateCacheBrickOnHead(){this.cacheBrickOnHead=this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y-25)/16))&&!this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y-23)/16))||this.map.isBrick(d.trunc((this.x+9)/32),d.trunc((this.y-25)/16))&&!this.map.isBrick(d.trunc((this.x+9)/32),d.trunc((this.y-23)/16))||this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y-24)/16))&&!this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y-8)/16))||this.map.isBrick(d.trunc((this.x+9)/32),d.trunc((this.y-24)/16))&&!this.map.isBrick(d.trunc((this.x+9)/32),d.trunc((this.y-8)/16))}isOnGround(){return this.cacheOnGround}isBrickOnHead(){return this.cacheBrickOnHead}isBrickCrouchOnHead(){return this.cacheBrickCrouchOnHead}destroy(){this.graphics.destroy()}}class ge{constructor(e){this.g=e,this.map=e.map;var t=this;this.app=new F.a.Application(window.innerWidth,window.innerHeight,{antialias:!1,resolution:1,transparent:!0}),this.app.view.style.display="block";var s=document.getElementById("game");s.appendChild(this.app.view),this.stage=this.app.stage,this.mapGraphics=new F.a.Graphics,this.mapGraphics.beginFill(10066329),this.mapGraphics.lineStyle(1,11184810),this.stage.addChild(this.mapGraphics),this.floatCamera=!1,this.halfWidth=0,this.halfHeight=0,this.mapDx=0,this.mapDy=0,this.bricksPerLine=8,this.paletteCustomTexture=null,this.bricksPerLineCustom=0,window.addEventListener("resize",function(){t.recalcFloatCamera(t)},!1),s.onclick=function(e){for(var s=-1,i=0;i<t.g.players.length;i++)t.g.players[i].follow&&(t.g.players[i].follow=!1,(s=i+1)>t.g.players.length-1&&(s=0));-1!=s&&(t.g.players[s].follow=!0,console.log("Follow player "+t.g.players[s].displayName))}}async updatePaletteTexture(e){this.paletteCustomTexture=F.a.BaseTexture.from(e);var t=await d.getImageDimensions(e);this.bricksPerLineCustom=Math.floor(t.w/i.BRICK_WIDTH),console.log("palette loaded = "+this.paletteCustomTexture.hasLoaded),console.log("change palette. Brickes per line "+this.paletteCustomTexture.width+" "+this.bricksPerLineCustom)}renderMap(){document.body.style.background="url('images/bg_"+this.map.bg+".jpg')";var e=this;this.g.map.destroyBrickObjects();var t,s,a=this.map.getRows(),r=this.map.getCols();for(t=0;t<a;t++)for(s=0;s<r;s++)if(this.map.isBrick(s,t)){var h=this.map.getBrick(s,t),o=this.g.resources.palette.texture,n=this.bricksPerLine;null!=this.map.paletteCustomImage&&h>53&&h<=181?(o=this.paletteCustomTexture,n=this.bricksPerLineCustom,h-=this.map.paletteCustomIndex):h-=this.map.paletteIndex;var l=new F.a.Texture(o,new F.a.Rectangle(h%n*i.BRICK_WIDTH,Math.floor(h/n)*i.BRICK_HEIGHT,i.BRICK_WIDTH,i.BRICK_HEIGHT)),p=new F.a.Sprite(l);p.position.x=s*i.BRICK_WIDTH,p.position.y=t*i.BRICK_HEIGHT,this.map.brickObjects.push({idx:h,row:t,col:s,rect:function(){return e.map.brickRect(this.row,this.col)},sprite:p,mech:this.g.config.brickMech?this.g.render.createMech(0,0,i.BRICK_WIDTH,i.BRICK_HEIGHT):null}),this.mapGraphics.addChild(p)}this.map.spawnObjects(),this.recalcFloatCamera(this),this.app.render(this.stage)}recalcFloatCamera(e){console.log("resize event"),e.app.view.width=window.innerWidth-20,e.app.view.height=window.innerHeight,e.floatCamera=e.map.getRows()>window.innerHeight/16||e.map.getCols()>(window.innerWidth-20)/32,e.floatCamera?(e.halfWidth=Math.floor((window.innerWidth-20)/2),e.halfHeight=Math.floor(window.innerHeight/2)):(e.mapGraphics.x=e.mapDx=Math.floor((window.innerWidth-20-32*e.map.getCols())/2),e.mapGraphics.y=e.mapDy=Math.floor((window.innerHeight-16*e.map.getRows())/2))}renderGame(e){var t=e.x+this.mapDx,s=e.y+this.mapDy;this.floatCamera&&e.follow&&(this.mapDx=this.mapGraphics.x=this.halfWidth-e.x,this.mapDy=this.mapGraphics.y=this.halfHeight-e.y),e.graphics.adjustPosition(t,s),this.app.render(this.stage)}renderLabels(){this.g.labels.adjustPosition()}renderMech(){for(var e=0;e<this.g.players.length;e++)this.g.players[e].graphics.mech.x=this.g.players[e].rect().x1,this.g.players[e].graphics.mech.y=this.g.players[e].rect().y1,this.g.players[e].graphics.mech.width=this.g.players[e].rect().x2-this.g.players[e].rect().x1,this.g.players[e].graphics.mech.height=this.g.players[e].rect().y2-this.g.players[e].rect().y1,this.g.players[e].graphics.mech.visible=!0;for(e=0;e<this.g.objects.length;e++)this.g.objects[e].mech.x=this.g.objects[e].rect().x1,this.g.objects[e].mech.y=this.g.objects[e].rect().y1,this.g.objects[e].mech.width=this.g.objects[e].rect().x2-this.g.objects[e].rect().x1,this.g.objects[e].mech.height=this.g.objects[e].rect().y2-this.g.objects[e].rect().y1,this.g.objects[e].mech.visible=!0;if(this.g.config.brickMech)for(e=0;e<this.g.map.brickObjects.length;e++){var t=this.g.map.brickObjects[e].rect();this.g.map.brickObjects[e].mech.x=t.x1,this.g.map.brickObjects[e].mech.y=t.y1,this.g.map.brickObjects[e].mech.width=t.x2-t.x1,this.g.map.brickObjects[e].mech.height=t.y2-t.y1,this.g.map.brickObjects[e].mech.visible=!0}}createMech(e,t,s,i){var a=new F.a.Graphics;return a.lineStyle(2,16711935),a.drawRect(e,t,s,i),this.stage.addChild(a),a}removeMech(e){this.stage.removeChild(e)}}var _e=s(2);class De{constructor(e){this.g=e,this.stage=e.render.stage,this.textPause=new F.a.Text("Game Paused",{fontFamily:"Arial",fontSize:25,fill:"red",align:"center"}),this.textPause.anchor=new F.a.Point(.5,.5),this.textPause.x=window.innerWidth/2,this.textPause.y=window.innerHeight/2,this.stage.addChild(this.textPause),this.gameTime=new F.a.Text("0:00",{fontFamily:"Arial",fontSize:14,fill:"white",align:"center"}),this.gameTime.anchor=new F.a.Point(.5,.5),this.gameTime.x=window.innerWidth-145,this.gameTime.y=20,this.stage.addChild(this.gameTime),this.textUsage=new F.a.Text("ESC = pause    TAB = score board",{fontFamily:"Arial",fontSize:12,fill:"white",align:"left"}),this.textUsage.x=15,this.textUsage.y=window.innerHeight-20,this.textUsage.alpha=.5,this.stage.addChild(this.textUsage),this.scoreboard=new Ee(e),this.scoreboard.container.visible=!1}adjustPosition(){this.textPause.visible=this.g.gamestate.paused,this.scoreboard.container.visible=G.keyTab||this.g.gamestate.gameend,this.textPause.visible&&d.bringToFront(this.textPause),this.scoreboard.container.visible&&(d.bringToFront(this.scoreboard.container),this.scoreboard.update()),this.gameTime.text=Math.floor(this.g.gamestate.gametime/60).toString().padStart(2,"0")+":"+(this.g.gamestate.gametime%60).toString().padStart(2,"0")}destroy(){this.stage.removeChild(this.textPause)}}class Ee{constructor(e){this.g=e,this.colorRed=F.a.utils.string2hex("#FF4500"),this.colorBlue=F.a.utils.string2hex("#00BFFF"),this.textStyle={fontFamily:"Arial",fontSize:14,fill:"white",align:"left"},this.textStyleRed={fontFamily:"Arial",fontSize:14,fontWeight:"bold",fill:this.colorRed,align:"left"},this.textStyleBlue={fontFamily:"Arial",fontSize:14,fontWeight:"bold",fill:this.colorBlue,align:"left"},this.container=new F.a.Container;this.container.x=window.innerWidth/2-250,this.container.y=window.innerHeight/2-130,this.g.render.stage.addChild(this.container),this.background=new F.a.Graphics,this.background.beginFill(0),this.background.drawRect(0,0,500,260),this.background.endFill(),this.background.alpha=.8,this.container.addChild(this.background),this.textItems=new F.a.Graphics,this.container.addChild(this.textItems),this.lastUpdated=0}update(){this.lastUpdated>=this.g.gamestate.gametime||(this.updateScoreboard(),this.lastUpdated=this.g.gamestate.gametime)}updateScoreboard(){for(var e=this.textItems.children.length-1;e>=0;e--)this.textItems.children[e].destroy(),this.textItems.removeChild(this.textItems.children[e]);var t=new F.a.Text("NAME",this.textStyleRed);t.x=30,t.y=70,this.textItems.addChild(t);var s=new F.a.Text("FRAGS",this.textStyleRed);s.x=300,s.y=70,this.textItems.addChild(s);var a=new F.a.Text("PING",this.textStyleRed);a.x=400,a.y=70,this.textItems.addChild(a);var r=0,h=0;for(e=0;e<this.g.players.length;e++){var o=90+20*e,n=this.colorRed;this.g.players[e].team==i.C_TEAMBLUE?(n=this.colorBlue,h+=this.g.players[e].frags):r+=this.g.players[e].frags;var l=new F.a.Graphics;l.beginFill(n),l.drawRect(20,o+3,5,10),l.endFill(),this.textItems.addChild(l);var p=new F.a.Text(this.g.players[e].displayName,this.textStyle);p.x=30,p.y=o,this.textItems.addChild(p);var d=new F.a.Text(this.g.players[e].frags,this.textStyle);d.x=300,d.y=o,this.textItems.addChild(d);var c=new F.a.Text(this.g.players[e].ping,this.textStyle);c.x=400,c.y=o,this.textItems.addChild(c)}var u=new F.a.Text("RED CAPTURES: "+this.g.gamestate.redscore,this.textStyleRed);u.x=150,u.y=20,this.textItems.addChild(u);var m=new F.a.Text("RED SCORE: "+r,this.textStyleRed);m.x=177,m.y=40,this.textItems.addChild(m);var y=new F.a.Text("BLUE CAPTURES: "+this.g.gamestate.bluescore,this.textStyleBlue);y.x=300,y.y=20,this.textItems.addChild(y);var g=new F.a.Text("BLUE SCORE: "+h,this.textStyleBlue);g.x=327,g.y=40,this.textItems.addChild(g)}}class we{constructor(e,t,s,i){this.id=e,this.tickInterval=t,this.stopAfter=s,this.callback=i,this.stop()}start(){this.enabled=!0}stop(){this.enabled=!1,this.ticks=0}tick(){this.enabled&&this.callback&&(this.ticks++%this.tickInterval==0&&this.callback(this.id,Math.floor(this.ticks/this.tickInterval)),this.stopAfter>0&&this.ticks>=this.stopAfter&&this.stop())}}class fe{constructor(){this.timers=[]}addTimer(e,t,s){return this.addTickTimer(e*i.FPS,t*i.FPS,s)}addTimeout(e,t){var s=this;return this.addTickTimer(e*i.FPS,e*i.FPS*2,function(e,i){1==i&&(t(e,i),s.removeTimer(e))})}addTickTimer(e,t,s){var i=d.random(1,9999999),a=new we(i,e,t,s);return a.start(),this.timers.push(a),i}tick(){for(var e=0;e<this.timers.length;e++)this.timers[e].tick()}stopTimer(e){for(var t=0;t<this.timers.length;t++)if(this.timers[t].id==e){this.timers[t].stop();break}}startTimer(e){for(var t=0;t<this.timers.length;t++)if(this.timers[t].id==e){this.timers[t].start();break}}removeTimer(e){for(var t=0;t<this.timers.length;t++)if(this.timers[t].id==e){this.timers.splice(t,1);break}}clearTimers(){this.timers=[]}}class Te{constructor(e){this.g=e,this.players=e.players,this.data={},this.frameId=0}loadFromQuery(e){var t=window.location.href.slice(window.location.href.indexOf("?")+1);if(0===t.indexOf("demourl=")){var s=decodeURIComponent(t.substring(8)).replace(/\+/g," ");s=this.g.config.demoServiceUrl+s+"&full=true",p.writeText("loading demo from url "+s),this.load(s,e)}}load(e,t){var s=this;this._loadJSON(e,function(e){d.removeHtmlElement("loading"),s.data=e,t(s)},function(e){d.removeHtmlElement("loading"),p.writeText("error loading demo"),console.error(e)})}spawnPlayer(e,t){var s=new ye(this.g,e,t);return 0==this.players.length&&(s.follow=!0),this.players.push(s),s}nextFrame(e){if(this.frameId>this.data.DemoUnits.length-1)return D.play("gameend"),console.log("end of demo"),this.g.gamestate.gameend=!0,!1;var t=this.data.DemoUnits[this.frameId],s=t.DemoUnit;if(e!=t.DData.gametic)return!0;switch(this.frameId++,this.g.gamestate.gametime=t.DData.gametime,this.g.gamestate.gametick=t.DData.gametick,t.DData.type0){case i.DDEMO_TIMESET:this.g.timerManager.clearTimers(),0==s.warmup&&(D.play("matchstart"),this.g.map.spawnObjects());break;case i.DDEMO_PLAYERPOSV3:for(var a=0;a<this.players.length;a++)if(s.DXID==this.players[a].DXID){this.players[a].x=s.x,this.players[a].y=s.y,this.players[a].velocityX=s.inertiax,this.players[a].velocityY=s.inertiay,(s.PUV3&i.PUV3_DIR0)==i.PUV3_DIR0&&(this.players[a].dir=i.DIR_LW),(s.PUV3&i.PUV3_DIR1)==i.PUV3_DIR1&&(this.players[a].dir=i.DIR_RW),(s.PUV3&i.PUV3_DIR2)==i.PUV3_DIR2&&(this.players[a].dir=i.DIR_LS),(s.PUV3&i.PUV3_DIR3)==i.PUV3_DIR3&&(this.players[a].dir=i.DIR_RS),(s.PUV3&i.PUV3_DEAD0)==i.PUV3_DEAD0&&this.players[a].setDead(0),(s.PUV3&i.PUV3_DEAD1)==i.PUV3_DEAD1&&this.players[a].setDead(1),(s.PUV3&i.PUV3_DEAD2)==i.PUV3_DEAD2&&this.players[a].setDead(2),(s.PUV3&i.PUV3_WPN0)==i.PUV3_WPN0&&this.players[a].setWeapon(i.C_WPN_GAUNTLET),(s.PUV3&i.PUV3_WPN1)==i.PUV3_WPN1&&this.players[a].setWeapon(i.C_WPN_MACHINE),(s.PUV3&i.PUV3_WPN2)==i.PUV3_WPN2&&this.players[a].setWeapon(i.C_WPN_SHOTGUN),(s.PUV3&i.PUV3_WPN3)==i.PUV3_WPN3&&this.players[a].setWeapon(i.C_WPN_GRENADE),(s.PUV3&i.PUV3_WPN4)==i.PUV3_WPN4&&this.players[a].setWeapon(i.C_WPN_ROCKET),(s.PUV3&i.PUV3_WPN5)==i.PUV3_WPN5&&this.players[a].setWeapon(i.C_WPN_SHAFT),(s.PUV3&i.PUV3_WPN6)==i.PUV3_WPN6&&this.players[a].setWeapon(i.C_WPN_RAIL),(s.PUV3&i.PUV3_WPN7)==i.PUV3_WPN7&&this.players[a].setWeapon(i.C_WPN_PLASMA),(s.PUV3B&i.PUV3B_WPN8)==i.PUV3B_WPN8&&this.players[a].setWeapon(i.C_WPN_BFG);var r=(s.PUV3B&i.PUV3B_CROUCH)==i.PUV3B_CROUCH;this.players[a].setCrouch(r),this.players[a].BALLOON=(s.PUV3B&i.PUV3B_BALLOON)==i.PUV3B_BALLOON,0==this.players[a].dead&&(s.PUV3&i.PUV3_DEAD1)==i.PUV3_DEAD1?this.players[a].graphics.stop():this.players[a].graphics.play(),this.players[a].dead>0&&(s.PUV3&i.PUV3_DEAD0)==i.PUV3_DEAD0&&this.players[a].rewardtime>0&&(this.players[a].rewardtime=0),this.players[a].fangle=1.40625*s.wpnang,this.players[a].dir==i.DIR_RW||this.players[a].dir==i.DIR_RS?(this.players[a].fangle>180&&(this.players[a].fangle=this.players[a].fangle),this.players[a].fangle-=90):(this.players[a].fangle<=180&&(this.players[a].fangle=this.players[a].fangle),this.players[a].fangle=270-this.players[a].fangle),this.players[a].ammo_mg=s.currammo,this.players[a].ammo_sg=s.currammo,this.players[a].ammo_gl=s.currammo,this.players[a].ammo_rl=s.currammo,this.players[a].ammo_sh=s.currammo,this.players[a].ammo_rg=s.currammo,this.players[a].ammo_pl=s.currammo,this.players[a].ammo_bfg=s.currammo}break;case i.DDEMO_HAUPDATE:for(a=0;a<this.players.length;a++)s.DXID==this.players[a].DXID&&(this.players[a].health=s.health,this.players[a].armor=s.armor,this.players[a].frags=s.frags);break;case i.DDEMO_CREATEPLAYERV2:var h=s.netname,o=this.spawnPlayer(s.DXID,h);console.log(s);var n=s.modelname.split("+");o.setModel(n[0],n[1]),o.changeTeam(s.team),console.log("player joined "+h);break;case i.DDEMO_TEAMSELECT:for(a=0;a<this.players.length;a++)s.DXID==this.players[a].DXID&&this.players[a].changeTeam(s.team);break;case i.DDEMO_PLAYERMODELCHANGE:for(a=0;a<this.players.length;a++)if(s.DXID==this.players[a].DXID){console.log("changemodel ",s);n=s.newstr.split("+");this.players[a].setModel(n[0],n[1])}break;case i.DDEMO_DROPPLAYER:for(var l=0;l<this.players.length;l++)this.players[l].DXID==s.DXID&&(console.log("player left "+this.players[l].name),this.players[l].destroy(),this.players.splice(l,1));break;case i.DDEMO_DAMAGEPLAYER:for(a=0;a<this.players.length;a++)s.DXID==this.players[a].DXID&&(this.players[a].health=s.health,D.playPain(this.players[a]));break;case i.DDEMO_CTF_EVENT_FLAGPICKUP:console.log("flag pickup"),s.DXID=s.PlayerDXID;case i.DDEMO_CTF_EVENT_FLAGTAKEN:D.play("flagtk");for(a=0;a<this.players.length;a++)if(s.DXID==this.players[a].DXID){var c=this.players[a].team==i.C_TEAMBLUE?i.IT_RED_FLAG:i.IT_BLUE_FLAG;for(var u in this.g.objects)if(this.g.objects[u].itemId==c){this.players[a].flag=this.g.objects[u],console.log("flag "+c+" taken by "+this.players[a].displayName);break}}break;case i.DDEMO_CTF_EVENT_FLAGRETURN:D.play("flagret");c=s.team==i.C_TEAMBLUE?i.IT_BLUE_FLAG:i.IT_RED_FLAG;for(var u in this.g.objects)if(this.g.objects[u].itemId==c){this.g.objects[u].returnToBase(),console.log("flag "+c+" returned");break}break;case i.DDEMO_CTF_EVENT_FLAGCAPTURE:D.play("flagcap");for(a=0;a<this.players.length;a++)s.DXID==this.players[a].DXID&&this.players[a].flag.returnToBase();break;case i.DDEMO_EARNPOWERUP:break;case i.DDEMO_CHATMESSAGE:var m="";for(l=0;l<this.players.length;l++)if(this.players[l].DXID==s.TDNETCHATMessage.DXID){m+=this.players[l].displayName+": ";break}m+=d.filterNickName(s.MessageText),p.writeText(m),D.play("talk");break;case i.DDEMO_CTF_GAMESTATE:case i.DDEMO_CTF_GAMESTATESCORE:case i.DDEMO_DOM_SCORECHANGED:this.g.gamestate.redscore=s.RedScore,this.g.gamestate.bluescore=s.BlueScore;break;case i.DDEMO_KILLOBJECT:break;case i.DDEMO_FIREBFG:case i.DDEMO_FIREROCKET:case i.DDEMO_FIREPLASMAV2:for(l=0;l<this.players.length;l++)this.players[l].DXID==s.spawnerDxid&&this.players[l].weapon.fire(s.x,s.y,s.inertiax,s.inertiay);break;case i.DDEMO_FIREGREN:case i.DDEMO_FIRERAIL:case i.DDEMO_FIRESHOTGUN:case i.DDEMO_FIREMACH:for(l=0;l<this.players.length;l++)this.players[l].DXID==s.spawnerDxid&&this.players[l].weapon.fireVector(s.x,s.y,s.cx,s.cy,s.inertiax,s.inertiay);break;case i.DDEMO_GAUNTLETSTATE:for(l=0;l<this.players.length;l++)this.players[l].DXID==s.DXID&&(console.log(s.State),0==s.State?this.players[l].weapon.stop():this.players[l].weapon.use&&this.players[l].weapon.use(s.State));break;case i.DDEMO_NEW_SHAFTBEGIN:for(l=0;l<this.players.length;l++)this.players[l].DXID==s.DXID&&this.players[l].weapon.fire(s.AMMO);break;case i.DDEMO_NEW_SHAFTEND:for(l=0;l<this.players.length;l++)this.players[l].DXID==s.DXID&&this.players[l].weapon.stop();break;case i.DDEMO_JUMPSOUND:for(l=0;l<this.players.length;l++)this.players[l].DXID==s.dxid&&this.players[l].jump();break;case i.DDEMO_JUMPPADSOUND:break;case i.DDEMO_RESPAWNSOUND:D.play("respawn");break;case i.DDEMO_LAVASOUND:D.play("lava");break;case i.DDEMO_POWERUPSOUND:for(var u in this.g.objects)this.g.objects[u].x==s.x&&this.g.objects[u].y==s.y&&this.g.objects[u].show();break;case i.DDEMO_FLIGHTSOUND:D.play("flight");break;case i.DDEMO_NOAMMOSOUND:D.play("noammo");break;case i.DDEMO_GENERICSOUNDDATA:case i.DDEMO_GENERICSOUNDSTATDATA:break;case i.DDEMO_GENERICSOUNDDATA:console.log("sound "+s.SoundType)}return this.nextFrame(e),!0}_loadJSON(e,t,s){var i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(200===i.status?t&&t(JSON.parse(i.responseText)):s&&s(i))},i.open("GET",e,!0),i.send()}}var Ie=new(s.n(_e).a);document.getElementById("fps").appendChild(Ie.domElement);var Pe=new class{constructor(){this.resources={},this.map=new H(this),this.render=new ge(this),this.players=[],this.demo=new Te(this),this.objects=[],this.timerManager=new fe,this.labels=new De(this),this.gamestate={gametime:0,gametic:0,paused:!1,gameend:!1,redscore:0,bluescore:0},this.config={demoServiceUrl:"http://nfk.harpywar.com:8080/demo?url=",mode:"production",volume:.1,default_bg:2,mech:!1,brickMech:!1},D.setVolume(this.config.volume)}initPlayerModels(e){return{sarge:{default:this.getPlayerModels(e,"sarge","d"),red:this.getPlayerModels(e,"sarge","r"),blue:this.getPlayerModels(e,"sarge","b"),nuker:this.getPlayerModels(e,"sarge","nuker"),white:this.getPlayerModels(e,"sarge","white"),yellow:this.getPlayerModels(e,"sarge","bn"),dark:this.getPlayerModels(e,"sarge","dk")},keel:{default:this.getPlayerModels(e,"keel","d"),red:this.getPlayerModels(e,"keel","r"),blue:this.getPlayerModels(e,"keel","b"),nuker:this.getPlayerModels(e,"keel","n"),white:this.getPlayerModels(e,"keel","white1"),yellow:this.getPlayerModels(e,"keel","y"),dark:this.getPlayerModels(e,"keel","dk")},xaero:{default:this.getPlayerModels(e,"xaero","d"),red:this.getPlayerModels(e,"xaero","r"),blue:this.getPlayerModels(e,"xaero","b"),silver:this.getPlayerModels(e,"xaero","s"),white:this.getPlayerModels(e,"xaero","w"),yellow:this.getPlayerModels(e,"xaero","y"),green:this.getPlayerModels(e,"xaero","g"),dark:this.getPlayerModels(e,"xaero","dk")},crashed:{default:this.getPlayerModels(e,"crashed","d"),red:this.getPlayerModels(e,"crashed","r"),blue:this.getPlayerModels(e,"crashed","b"),green:this.getPlayerModels(e,"crashed","g")},doom2:{default:this.getPlayerModels(e,"doom2","d"),red:this.getPlayerModels(e,"doom2","r"),blue:this.getPlayerModels(e,"doom2","b"),magenta:this.getPlayerModels(e,"doom2","m"),white:this.getPlayerModels(e,"doom2","w"),yellow:this.getPlayerModels(e,"doom2","y"),green:this.getPlayerModels(e,"doom2","g"),dark:this.getPlayerModels(e,"doom2","dk"),phobos:this.getPlayerModels(e,"doom2","p")}}}getPlayerModels(e,t,s){return[new V(this,e,t,s,"w"),new V(this,e,t,s,"c"),new V(this,e,t,s,"d")]}};async function xe(){await Pe.map.loadFromDemo(Pe.demo.data.Map),Pe.render.renderMap();var e=0;requestAnimationFrame(function t(s){if(Ie.begin(),!Pe.gamestate.paused){for(var a=0;a<Pe.players.length;a++){Pe.players[a].physics.updateGame(s),Pe.render.renderGame(Pe.players[a]);for(var r=0;r<Pe.objects.length;r++)Pe.objects[r].handleCollisions(Pe.players[a])}for(a=0;a<Pe.map.brickObjects.length;a++)for(r=0;r<Pe.objects.length;r++)Pe.objects[r].handleBrickCollisions(Pe.map.brickObjects[a]);if(Pe.config.mech&&Pe.render.renderMech(),!Pe.demo.nextFrame(e))return;++e>=i.FPS&&(e=0),Pe.timerManager.tick()}Pe.render.renderLabels(),requestAnimationFrame(t),Ie.end()})}console.log("mode: "+Pe.config.mode),G.onKeyUp(27,function(){Pe.gamestate.paused=!Pe.gamestate.paused}),PIXI.loader.onLoad.add(function(e,t){}),PIXI.loader.add("palette","images/palette.png").add("railhit","images/railhit.png").add("glow","images/glow.png").add("weapons","images/weapons.json").add("explosion","images/explosion.json").add("mgun","images/mgun.json").add("jumppad","images/jumppad.json").add("gauntlet","images/gauntlet.json").add("bullets","images/bullets.json").add("medkits","images/medkits.json").add("portal","images/portal.png").add("flash","images/flash.png").add("mega","images/mega.json").add("flag","images/flag.json").add("powerup","images/powerup.json").add("armors","images/armors.json").add("items","images/items.json").add("sarge","images/models/sarge.json").add("xaero","images/models/xaero.json").add("keel","images/models/keel.json").add("doom2","images/models/doom2.json").add("crashed","images/models/crashed.json").load(function(e,t){Pe.resources=t,"development"==Pe.config.mode?Pe.demo.load("demo6.json",xe):Pe.demo.loadFromQuery(xe);console.log("demo loaded")})}]);