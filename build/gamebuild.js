!function(t){var e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/build/",s(s.s=3)}([function(t,e){t.exports=Howl},function(t,e){t.exports=PIXI},function(t,e){t.exports=Stats},function(t,e,s){"use strict";s.r(e);var i={FPS:50,BRICK_WIDTH:32,BRICK_HEIGHT:16,PLAYER_WIDTH:20,PLAYER_HEIGHT:48,PLAYER_HEIGHT_CROUCH:32,PLAYER_MAX_VELOCITY_X:3,C_TEAMBLUE:0,C_TEAMRED:1,C_TEAMNON:2,C_WPN_GAUNTLET:0,C_WPN_MACHINE:1,C_WPN_SHOTGUN:2,C_WPN_GRENADE:3,C_WPN_ROCKET:4,C_WPN_SHAFT:5,C_WPN_RAIL:6,C_WPN_PLASMA:7,C_WPN_BFG:8,DIR_LW:0,DIR_RW:1,DIR_LS:2,DIR_RS:3,GAMETYPE_FFA:0,GAMETYPE_1V1:1,GAMETYPE_TEAM:2,GAMETYPE_CTF:3,GAMETYPE_RAILARENA:4,GAMETYPE_TRIXARENA:5,GAMETYPE_PRACTICE:6,GAMETYPE_DOMINATION:7,COLORARRAY:[268435455,4278190208,4278222848,4286578688,4286578816,4286611456,4286611584,4290822336,4278190335,4278255360,4278255615,4294901760,4294902015,4294967040,4290822336,4286611584,4278190080],IT_NONE:0,IT_SHOTGUN:1,IT_GRENADE:2,IT_ROCKET:3,IT_SHAFT:4,IT_RAIL:5,IT_PLASMA:6,IT_BFG:7,IT_AMMO_MACHINEGUN:8,IT_AMMO_SHOTGUN:9,IT_AMMO_GRENADE:10,IT_AMMO_ROCKET:11,IT_AMMO_SHAFT:12,IT_AMMO_RAIL:13,IT_AMMO_PLASMA:14,IT_AMMO_BFG:15,IT_SHARD:16,IT_YELLOW_ARMOR:17,IT_RED_ARMOR:18,IT_HEALTH_5:19,IT_HEALTH_25:20,IT_HEALTH_50:21,IT_HEALTH_100:22,IT_POWERUP_REGENERATION:23,IT_POWERUP_BATTLESUIT:24,IT_POWERUP_HASTE:25,IT_POWERUP_QUAD:26,IT_POWERUP_FLIGHT:27,IT_POWERUP_INVISIBILITY:28,IT_TRIX_GRENADE:29,IT_TRIX_ROCKET:30,IT_LAVA:31,IT_WATER:32,IT_DEATH:33,IT_RESPAWN:34,IT_RED_RESPAWN:35,IT_BLUE_RESPAWN:36,IT_EMPTY:37,IT_JUMPPAD:38,IT_JUMPPAD2:39,IT_BLUE_FLAG:40,IT_RED_FLAG:41,IT_DOMINATION_FLAG:42,DDEMO_VERSION:0,DDEMO_FIREROCKET:1,DDEMO_PLAYERPOS:2,DDEMO_TIMESET:3,DDEMO_CREATEPLAYER:4,DDEMO_KILLOBJECT:5,DDEMO_FIREBFG:6,DDEMO_FIREPLASMA:7,DDEMO_FIREGREN:8,DDEMO_FIRERAIL:9,DDEMO_FIRESHAFT:10,DDEMO_FIRESHOTGUN:11,DDEMO_FIREMACH:12,DDEMO_ITEMDISSAPEAR:13,DDEMO_ITEMAPEAR:14,DDEMO_DAMAGEPLAYER:15,DDEMO_HAUPDATE:16,DDEMO_FLASH:17,DDEMO_JUMPSOUND:18,DDEMO_GAMEEND:19,DDEMO_RESPAWNSOUND:20,DDEMO_JUMPPADSOUND:21,DDEMO_LAVASOUND:22,DDEMO_POWERUPSOUND:23,DDEMO_EARNPOWERUP:24,DDEMO_READYPRESS:25,DDEMO_FLIGHTSOUND:26,DDEMO_EARNREWARD:27,DDEMO_STATS:28,DDEMO_GAMESTATE:29,DDEMO_TRIXARENAEND:30,DDEMO_OBJCHANGESTATE:31,DDEMO_CORPSESPAWN:32,DDEMO_GRENADESYNC:33,DDEMO_STATS2:34,DDEMO_PLAYERPOSV2:35,DDEMO_FIREGRENV2:36,DDEMO_NOAMMOSOUND:37,DDEMO_GAUNTLETSTATE:38,DDEMO_STATS3:39,DDEMO_FIREPLASMAV2:40,DDEMO_PLAYERPOSV3:41,DDEMO_BUBBLE:42,DDEMO_MPSTATE:43,DDEMO_NETRAIL:44,DDEMO_NETPARTICLE:45,DDEMO_NETTIMEUPDATE:46,DDEMO_NETSVMATCHSTART:47,DDEMO_DROPPLAYER:48,DDEMO_CREATEPLAYERV2:49,DDEMO_SPECTATORCONNECT:50,DDEMO_SPECTATORDISCONNECT:51,DDEMO_CHATMESSAGE:52,DDEMO_PLAYERRENAME:53,DDEMO_PLAYERMODELCHANGE:54,DDEMO_GENERICSOUNDDATA:55,DDEMO_GENERICSOUNDSTATDATA:56,DDEMO_TEAMSELECT:57,DDEMO_CTF_EVENT_FLAGTAKEN:58,DDEMO_CTF_EVENT_FLAGCAPTURE:59,DDEMO_CTF_EVENT_FLAGDROP:60,DDEMO_CTF_EVENT_FLAGPICKUP:61,DDEMO_CTF_EVENT_FLAGDROP_APPLY:62,DDEMO_CTF_EVENT_FLAGRETURN:63,DDEMO_CTF_GAMESTATE:64,DDEMO_CTF_EVENT_FLAGDROPGAMESTATE:65,DDEMO_CTF_GAMESTATESCORE:66,DDEMO_CTF_FLAGCARRIER:67,DDEMO_DOM_CAPTURE:68,DDEMO_DOM_SCORECHANGED:69,DDEMO_WPN_EVENT_WEAPONDROP:70,DDEMO_WPN_EVENT_PICKUP:71,DDEMO_WPN_EVENT_WEAPONDROP_APPLY:72,DDEMO_WPN_EVENT_WEAPONDROPGAMESTATE:73,DDEMO_DOM_CAPTUREGAMESTATE:74,DDEMO_NEW_SHAFTBEGIN:75,DDEMO_NEW_SHAFTEND:76,DDEMO_POWERUP_EVENT_POWERUPDROP:77,DDEMO_POWERUP_EVENT_PICKUP:78,DDEMO_POWERUP_EVENT_POWERUPDROPGAMESTATE:79,DDEMO_CTF_EVENT_FLAGTAKEN_RED:80,DDEMO_CTF_EVENT_FLAGCAPTURE_RED:81,DDEMO_CTF_EVENT_FLAGDROP_RED:82,PUV3_DIR0:1,PUV3_DIR1:2,PUV3_DIR2:8,PUV3_DIR3:16,PUV3_DEAD0:32,PUV3_DEAD1:64,PUV3_DEAD2:128,PUV3_WPN0:256,PUV3_WPN1:512,PUV3_WPN2:1024,PUV3_WPN3:2048,PUV3_WPN4:4096,PUV3_WPN5:8192,PUV3_WPN6:16384,PUV3_WPN7:32768,PUV3B_WPN8:1,PUV3B_CROUCH:2,PUV3B_BALLOON:8};document.addEventListener("keydown",(function(t){192===t.keyCode&&((a=!a)?(r.classList.add("open"),h.scrollTop=h.scrollHeight,o.value="",o.focus()):r.classList.remove("open"),t.preventDefault())}));var a=!1,r=document.getElementById("console"),h=document.getElementById("console-content"),o=document.getElementById("console-input"),n=h.innerHTML;o.addEventListener("keydown",(function(t){if(13===t.keyCode){t.preventDefault();var e=o.value.trim();l.writeText(e),0===e.indexOf("map ")?document.location.href="?mapfile="+e.substring(4):"help"===e&&(l.writeText("Available commands:"),l.writeText("help"),l.writeText("map <mapname>")),o.value=""}}));var l={writeText(t){t=t.toString(),(n+="<br>"+function(t){return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}(t)).length>5e3&&(n=n.substring(n.length-5e3)),h.innerHTML=n,h.scrollTop=h.scrollHeight}},p=l,d={trunc:Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)},ord:t=>t.charCodeAt(0),random:(t,e)=>Math.floor(Math.random()*(e-t))+t,removeHtmlElement(t){var e=document.getElementById(t);e.parentNode.removeChild(e)},filterNickName(t){for(var e="",s=0;s<t.length;s++)"^"==t[s]?s++:e+=t[s];return e},getDelphiString(t){if(0==t.length)return t;var e=t[0].charCodeAt(0);return e<=t.length-1&&(t=t.substring(1,e+1)),t},getImageDimensions:t=>new Promise((function(e,s){var i=new Image;i.onload=function(){e({w:i.width,h:i.height})},i.src=t})),rectOverlap:(t,e)=>!(t.x1>=e.x2||e.x1>=t.x2||t.y1>=e.y2||e.y1>=t.y2),trimChars(t,e){var s=new RegExp("^["+e+"]+|["+e+"]+$","g");return t.replace(s,"")},bringToFront(t){if(t.parent){var e=t.parent;e.removeChild(t),e.addChild(t)}},formatGameTime:t=>(t<0&&(t=0),Math.floor(t/60).toString().padStart(2,"0")+":"+(t%60).toString().padStart(2,"0"))};class c{constructor(t,e,s){this.g=t,this.x=e,this.y=s,this.offsetX=0,this.offsetY=0,this.width=i.BRICK_WIDTH,this.height=i.BRICK_HEIGHT,this.animated=!1,this.animationSpeed=.2,this.animateOneTime=!1,this.frameStopped=0,this.frameStart=0,this.frameEnd=0,this.rotation=0,this.texture=null,this.sprite=null,this.anchor=!1,this.bullet=!1,this.overlaps=[],this.container=this.g.render.mapGraphics,this.timerIds=[]}spawn(){if(this.animated){this.sprite=new PIXI.AnimatedSprite(this.texture),this.sprite.animationSpeed=this.animationSpeed,this.sprite.play(),0==this.frameEnd&&(this.frameEnd=this.sprite.totalFrames-1);var t=this;this.sprite.onFrameChange=e=>{t.animateOneTime&&e==t.frameEnd&&(t.sprite.gotoAndStop(t.frameStopped),t.animateOneTime()),t.sprite.playing&&(0==e&&t.frameStart>0||e==t.frameEnd)&&t.sprite.gotoAndPlay(t.frameStart)}}else null!==this.texture&&(this.sprite=new PIXI.Sprite(this.texture));this.sprite.rotation=this.rotation,this.anchor&&this.sprite.anchor.set(this.anchor),this.setX(this.x),this.setY(this.y),this.container.addChild(this.sprite),this.mech=this.g.render.createMech(0,0,this.width,this.height),this.mech.visible=!1}play(){this.sprite.play&&this.sprite.play()}stop(){this.sprite.gotoAndStop&&this.sprite.gotoAndStop(this.frameStopped)}show(){this.sprite.visible=!0}hide(){this.sprite.visible=!1}visible(){return!this.sprite||this.sprite.visible}setX(t){this.x=t,this.sprite.x=this.x+this.offsetX}setY(t){this.y=t,this.sprite.y=this.y+this.offsetY}fadeOut(t,e){var s=this,i=this.g.timerManager.addTickTimer(1,0,(function(i,a){s.sprite.alpha-=t,s.sprite.alpha<=0&&(s.hide(),e())}));this.timerIds.push(i)}rect(){return{x1:this.x-this.width*this.sprite.anchor.x+this.g.render.mapDx,y1:this.y-this.height*this.sprite.anchor.y+this.g.render.mapDy,x2:this.x-this.width*this.sprite.anchor.x+this.width+this.g.render.mapDx,y2:this.y-this.height*this.sprite.anchor.y+this.height+this.g.render.mapDy}}handleCollisions(t,e){if(t.dead)return!1;if(!this.visible())return!1;var s=this.overlaps.indexOf(t.DXID);if(d.rectOverlap(this.rect(),t.rect()))return-1==s&&(this.overlaps.push(t.DXID),e(t));-1!=s&&this.overlaps.splice(s,1)}handleBrickCollisions(t,e){if(!this.bullet)return!1;if(!this.visible())return!1;var s=t.col+"_"+t.row+"_"+t.idx,i=this.overlaps.indexOf(s);if(d.rectOverlap(this.rect(),t.rect()))return-1==i&&(this.overlaps.push(s),e(t));-1!=i&&this.overlaps.splice(i,1)}destroy(){for(var t in this.timerIds)this.g.timerManager.removeTimer(t);this.container.removeChild(this.sprite),this.g.config.mech&&this.g.render.removeMech(this.mech)}}class u extends c{constructor(t,e,s){super(t,e,s),this.spawnDelay=0,this.respawnTime=0}spawn(){if(super.spawn(),this.spawnDelay>0){this.sprite.visible=!1;var t=this,e=this.g.timerManager.addTimeout(this.spawnDelay,(function(e,s){t.sprite.visible=!0}));this.timerIds.push(e)}}handleCollisions(t,e){if(super.handleCollisions(t,e)&&(this.sprite.visible=!1,this.respawnTime>0)){var s=this,i=this.g.timerManager.addTimeout(this.respawnTime,(function(t,e){s.sprite.visible=!0}));this.timerIds.push(i)}}}var m=s(0),g=s.n(m),y={wpkup:new g.a({urls:["sounds/wpkup.wav"]}),ammopkup:new g.a({urls:["sounds/ammopkup.wav"]}),armor:new g.a({urls:["sounds/armor.wav"]}),shard:new g.a({urls:["sounds/shard.wav"]}),health5:new g.a({urls:["sounds/health5.wav"]}),health25:new g.a({urls:["sounds/health25.wav"]}),health50:new g.a({urls:["sounds/health50.wav"]}),health100:new g.a({urls:["sounds/health100.wav"]}),talk:new g.a({urls:["sounds/talk.wav"]}),expl:new g.a({urls:["sounds/expl.wav"]}),fire_bfg:new g.a({urls:["sounds/bfg_fire.wav"]}),fire_plasma:new g.a({urls:["sounds/plasma.wav"]}),fire_gren:new g.a({urls:["sounds/grenade.wav"]}),fire_rail:new g.a({urls:["sounds/rail.wav"]}),fire_shaft:new g.a({urls:["sounds/lg_hum.wav"]}),fire_shaft_begin:new g.a({urls:["sounds/lg_start.wav"]}),fire_shaft_end:new g.a({urls:["sounds/lg_hum.wav"]}),fire_shotgun:new g.a({urls:["sounds/shotgun.wav"]}),fire_mach:new g.a({urls:["sounds/machine.wav"]}),fire_rocket:new g.a({urls:["sounds/rocket.wav"]}),fire_gauntl0:new g.a({urls:["sounds/gauntl_r1.wavv"]}),fire_gauntl1:new g.a({urls:["sounds/gauntl_r2.wav"]}),fire_gauntl2:new g.a({urls:["sounds/gauntl_a.wav"]}),powerup_invis:new g.a({urls:["sounds/invisibility.wav"]}),powerup_haste:new g.a({urls:["sounds/haste.wav"]}),powerup_quad:new g.a({urls:["sounds/quaddamage.wav"]}),powerup_regen:new g.a({urls:["sounds/regeneration.wav"]}),powerup_battle:new g.a({urls:["sounds/holdable.wav"]}),flagtk:new g.a({urls:["sounds/flagtk.wav"]}),flagret:new g.a({urls:["sounds/flagret.wav"]}),flagcap:new g.a({urls:["sounds/flagcap.wav"]}),jumppad:new g.a({urls:["sounds/jumppad.wav"]}),respawn:new g.a({urls:["sounds/respawn.wav"]}),lava:new g.a({urls:["sounds/lava.wav"]}),powerup:new g.a({urls:["sounds/poweruprespawn.wav"]}),flight:new g.a({urls:["sounds/flight.wav"]}),noammo:new g.a({urls:["sounds/noammo.wav"]}),genericdata:new g.a({urls:["sounds/hit.wav"]}),gameend:new g.a({urls:["sounds/gameend.wav"]}),matchstart:new g.a({urls:["sounds/fight.wav"]}),model_sound_path:"sound/models/",models:{sarge:_("sarge"),xaero:_("xaero"),keel:_("keel"),doom2:_("doom2"),crashed:_("crashed")}};function _(t){return{jump:new g.a({urls:["sounds/models/"+t+"/jump1.wav"]}),death1:new g.a({urls:["sounds/models/"+t+"/death1.wav"]}),death2:new g.a({urls:["sounds/models/"+t+"/death2.wav"]}),death3:new g.a({urls:["sounds/models/"+t+"/death3.wav"]}),pain25:new g.a({urls:["sounds/models/"+t+"/pain25_1.wav"]}),pain50:new g.a({urls:["sounds/models/"+t+"/pain50_1.wav"]}),pain75:new g.a({urls:["sounds/models/"+t+"/pain75_1.wav"]}),pain100:new g.a({urls:["sounds/models/"+t+"/pain100_1.wav"]})}}var w={constructor(){this.volume=1},play(t,e){y[t].volume(this.volume),y[t].play()},playModel(t,e){y.models[t]||(t="sarge"),y.models[t][e].volume(this.volume),0==y.models[t][e].pos()&&y.models[t][e].play()},setVolume(t){this.volume=t},playJump(t){this.playModel(t.model,"jump")},playPain(t){var e=100;t.health<=25?e=25:t.health<=50?e=50:t.health<=75&&(e=75);var s="pain"+e;this.playModel(t.model,s)},playDeath(t){var e="death"+(d.random(1,3)+1);this.playModel(t.model,e)}};class D extends u{constructor(t,e,s){super(t,e,s),this.texture=t.resources.medkits.textures["Medkits-0.png"],this.itemId=i.IT_HEALTH_5,this.respawnTime=30,this.health=5}handleCollisions(t){var e=this;super.handleCollisions(t,(function(t){return t.addHealth(e.health,200),w.play("health5"),!0}))}}class E extends u{constructor(t,e,s){super(t,e,s),this.texture=t.resources.medkits.textures["Medkits-1.png"],this.offsetX=-3,this.itemId=i.IT_HEALTH_25,this.respawnTime=30,this.health=25}handleCollisions(t){var e=this;super.handleCollisions(t,(function(t){return!(t.health>=100)&&(t.addHealth(e.health,100),w.play("health25"),!0)}))}}class f extends u{constructor(t,e,s){super(t,e,s),this.texture=t.resources.medkits.textures["Medkits-2.png"],this.offsetX=-5,this.itemId=i.IT_HEALTH_50,this.respawnTime=30,this.health=50}handleCollisions(t){var e=this;super.handleCollisions(t,(function(t){return!(t.health>=100)&&(t.addHealth(e.health,100),w.play("health50"),!0)}))}}class T extends u{constructor(t,e,s){super(t,e,s),this.texture=t.resources.mega.spritesheet.animations.mega,this.animated=!0,this.offsetX=7,this.itemId=i.IT_HEALTH_100,this.respawnTime=60,this.health=100}handleCollisions(t){var e=this;super.handleCollisions(t,(function(t){return t.addHealth(e.health,200),w.play("health100"),!0}))}}class I extends u{constructor(t,e,s){super(t,e,s),this.texture=t.resources.items.textures["item-"+(i.IT_SHARD-1)+".png"],this.itemId=i.IT_SHARD,this.respawnTime=30,this.armor=5}handleCollisions(t){var e=this;super.handleCollisions(t,(function(t){return t.addArmor(e.armor),w.play("shard"),!0}))}}class P extends u{constructor(t,e,s){super(t,e,s),this.texture=t.resources.armors.spritesheet.animations.armors,this.animated=!0,this.frameStart=0,this.frameEnd=19,this.offsetY=-5,this.itemId=i.IT_YELLOW_ARMOR,this.respawnTime=30,this.armor=50}handleCollisions(t){var e=this;super.handleCollisions(t,(function(t){return t.addArmor(e.armor),w.play("armor"),!0}))}}class x extends u{constructor(t,e,s){super(t,e,s),this.texture=t.resources.armors.spritesheet.animations.armors,this.animated=!0,this.frameStart=20,this.frameEnd=39,this.offsetY=-5,this.itemId=i.IT_RED_ARMOR,this.respawnTime=30,this.armor=100}handleCollisions(t){var e=this;super.handleCollisions(t,(function(t){return t.addArmor(e.armor),w.play("armor"),!0}))}}class b extends u{constructor(t,e,s){super(t,e,s),this.texture=t.resources.powerup.spritesheet.animations.quad,this.animated=!0,this.offsetY=-16,this.itemId=i.IT_POWERUP_QUAD,this.spawnDelay=0,this.respawnTime=120}spawn(){super.spawn(),this.hide()}show(){super.show(),w.play("powerup")}handleCollisions(t){var e=this;super.handleCollisions(t,(function(t){return t.addPowerup(e.itemId),w.play("powerup_quad"),!0}))}}class A extends u{constructor(t,e,s){super(t,e,s),this.texture=t.resources.powerup.spritesheet.animations.fly,this.animated=!0,this.offsetY=-16,this.itemId=i.IT_POWERUP_FLIGHT,this.spawnDelay=0,this.respawnTime=120}spawn(){super.spawn(),this.hide()}show(){super.show(),w.play("powerup")}handleCollisions(t){var e=this;super.handleCollisions(t,(function(t){return t.addPowerup(e.itemId),!0}))}}class O extends u{constructor(t,e,s){super(t,e,s),this.texture=t.resources.powerup.spritesheet.animations.haste,this.animated=!0,this.offsetY=-16,this.itemId=i.IT_POWERUP_HASTE,this.spawnDelay=0,this.respawnTime=120}spawn(){super.spawn(),this.hide()}show(){super.show(),w.play("powerup")}handleCollisions(t){var e=this;super.handleCollisions(t,(function(t){return t.addPowerup(e.itemId),w.play("powerup_haste"),!0}))}}class v extends u{constructor(t,e,s){super(t,e,s),this.texture=t.resources.powerup.spritesheet.animations.battle,this.animated=!0,this.offsetY=-16,this.itemId=i.IT_POWERUP_BATTLESUIT,this.spawnDelay=0,this.respawnTime=120}spawn(){super.spawn(),this.hide()}show(){super.show(),w.play("powerup")}handleCollisions(t){var e=this;super.handleCollisions(t,(function(t){return t.addPowerup(e.itemId),w.play("powerup_battle"),!0}))}}class M extends u{constructor(t,e,s){super(t,e,s),this.texture=t.resources.powerup.spritesheet.animations.invis,this.animated=!0,this.offsetY=-16,this.itemId=i.IT_POWERUP_INVISIBILITY,this.spawnDelay=120,this.respawnTime=120}spawn(){super.spawn(),this.hide()}show(){super.show(),w.play("powerup")}handleCollisions(t){var e=this;super.handleCollisions(t,(function(t){return t.addPowerup(e.itemId),w.play("powerup_invis"),!0}))}}class C extends u{constructor(t,e,s){super(t,e,s),this.texture=t.resources.powerup.spritesheet.animations.invis,this.animated=!0,this.offsetY=-16,this.itemId=i.IT_POWERUP_REGENERATION,this.spawnDelay=0,this.respawnTime=120}spawn(){super.spawn(),this.hide()}show(){super.show(),w.play("powerup")}handleCollisions(t){var e=this;super.handleCollisions(t,(function(t){return t.addPowerup(e.itemId),w.play("powerup_regen"),!0}))}}class R extends u{constructor(t,e,s,i){super(t,e,s),this.texture=t.resources.items.textures["item-"+(i-1)+".png"],this.itemId=i,this.respawnTime=30}handleCollisions(t){var e=this;super.handleCollisions(t,(function(t){return t.addWeapon(e.itemId),w.play("wpkup"),e.sprite.visible=!1,!0}))}}class k extends c{constructor(t,e,s){super(t,e,s),this.g=t,this.initX=e,this.initY=s,this.texture=t.resources.flag.spritesheet.animations.flag,this.animated=!0,this.frameStart=14,this.frameEnd=27,this.offsetY-=26,this.itemId=i.IT_RED_FLAG}returnToBase(){for(var t=0;t<this.g.players.length;t++)this.g.players[t].flag&&this.g.players[t].flag.itemId==this.itemId&&(this.g.players[t].flag=null);this.setX(this.initX),this.setY(this.initY),this.sprite.scale.x=1,this.sprite.angle=0}handleCollisions(t){super.handleCollisions(t,(function(t){return!1}))}}class S extends c{constructor(t,e,s){super(t,e,s),this.initX=e,this.initY=s,this.texture=t.resources.flag.spritesheet.animations.flag,this.animated=!0,this.frameStart=0,this.frameEnd=13,this.offsetY-=26,this.itemId=i.IT_BLUE_FLAG}returnToBase(){for(var t=0;t<this.g.players.length;t++)this.g.players[t].flag&&this.g.players[t].flag.itemId==this.itemId&&(this.g.players[t].flag=null);this.setX(this.initX),this.setY(this.initY),this.sprite.scale.x=1,this.sprite.angle=0}handleCollisions(t){super.handleCollisions(t,(function(t){return!1}))}}class N extends c{constructor(t,e,s,a){super(t,e,s),this.texture=t.resources.jumppad.spritesheet.animations.jumppad,this.animated=!0,this.itemId=a?i.IT_JUMPPAD2:i.IT_JUMPPAD,this.strong=a}handleCollisions(t){super.handleCollisions(t,(function(t){return w.play("jumppad"),!1}))}}class U extends c{constructor(t,e,s){super(t,e,s)}handleCollisions(t,e){return super.handleCollisions(t,e)}}class L extends U{constructor(t,e,s){super(t,e,s),this.texture=t.resources.portal.texture,this.offsetX=-16,this.offsetY=-32}handleCollisions(t){super.handleCollisions(t,(function(t){return!1}))}}class H{constructor(t){this.g=t,this.rows=0,this.cols=0,this.bricks=[],this.brickObjects=[],this.specialObjects=[],this.respawns=[],this.bg=1,this.paletteImage="images/palette.png",this.paletteIndex=6,this.paletteCustomImage=null,this.paletteCustomIndex=54}async loadFromDemo(t){this.bg=t.Header.BG,0==this.bg&&(this.bg=this.g.config.default_bg),this.loadNFKMap(t.Bricks),t.PaletteBytes&&(this.paletteCustomImage="data:image/png;base64,"+t.PaletteBytes,await this.g.render.updatePaletteTexture(this.paletteCustomImage)),this.specialObjects=t.Objects}loadNFKMap(t){var e=t;this.rows=e.length;for(var s=0;s<e.length;s++){this.bricks[s]=[];var i=window.atob(e[s]);this.cols=i.length;for(var a=0;a<i.length;a++){var r=d.ord(i[a]);this.bricks[s][a]=r,34!=r&&35!=r&&36!=r||this.respawns.push({row:a,col:s})}}}spawnObjects(){this._destroyObjects();for(var t=0;t<this.g.map.bricks.length;t++)for(var e=0;e<this.g.map.bricks[t].length;e++){var s=this.g.map.bricks[t][e],a=t*i.BRICK_WIDTH,r=e*i.BRICK_HEIGHT;if(!(this.g.map.bricks[t][e]>53)){if(s>=i.IT_SHOTGUN&&s<=i.IT_BFG&&this.g.objects.push(new R(this.g,a,r,s)),s>=i.IT_AMMO_MACHINEGUN&&s<=i.IT_AMMO_BFG){s==i.IT_AMMO_MACHINEGUN&&100,s==i.IT_AMMO_PLASMA&&50,this.g.objects.push(new R(this.g,a,r,s,10))}s==i.IT_SHARD&&this.g.objects.push(new I(this.g,a,r)),s==i.IT_YELLOW_ARMOR&&this.g.objects.push(new P(this.g,a,r)),s==i.IT_RED_ARMOR&&this.g.objects.push(new x(this.g,a,r)),s==i.IT_HEALTH_5&&this.g.objects.push(new D(this.g,a,r)),s==i.IT_HEALTH_25&&this.g.objects.push(new E(this.g,a,r)),s==i.IT_HEALTH_50&&this.g.objects.push(new f(this.g,a,r)),s==i.IT_HEALTH_100&&this.g.objects.push(new T(this.g,a,r)),s==i.IT_POWERUP_REGENERATION&&this.g.objects.push(new C(this.g,a,r)),s==i.IT_POWERUP_BATTLESUIT&&this.g.objects.push(new v(this.g,a,r)),s==i.IT_POWERUP_HASTE&&this.g.objects.push(new O(this.g,a,r)),s==i.IT_POWERUP_QUAD&&this.g.objects.push(new b(this.g,a,r)),s==i.IT_POWERUP_FLIGHT&&this.g.objects.push(new A(this.g,a,r)),s==i.IT_POWERUP_INVISIBILITY&&this.g.objects.push(new M(this.g,a,r)),s==i.IT_JUMPPAD&&this.g.objects.push(new N(this.g,a,r,!1)),s==i.IT_JUMPPAD2&&this.g.objects.push(new N(this.g,a,r,!0)),s==i.IT_BLUE_FLAG&&this.g.objects.push(new S(this.g,a,r)),s==i.IT_RED_FLAG&&this.g.objects.push(new k(this.g,a,r))}}for(var h=0;h<this.specialObjects.length;h++){var o=this.specialObjects[h];a=o.x*i.BRICK_WIDTH,r=o.y*i.BRICK_HEIGHT;1==o.objtype&&this.g.objects.push(new L(this.g,a,r))}for(h=0;h<this.g.objects.length;h++)this.g.objects[h].spawn();console.log("spawned "+this.g.objects.length+" objects")}_destroyObjects(){for(var t=0;t<this.g.objects.length;t++)this.g.objects[t].destroy();this.g.objects=[],console.log("destroy objects")}destroyBrickObjects(){for(var t=0;t<this.brickObjects.length;t++)this.g.render.mapGraphics(this.sprite),this.g.render.removeMech(this.mech),this.brickObjects[t].sprite.destroy(),this.brickObjects[t].mech.destroy();this.brickObjects=[]}isBrick(t,e){return t>=this.rows||e>=this.cols||t<0||e<0||this.bricks[t][e]>53}getBrick(t,e){return this.bricks[t][e]}brickRect(t,e){return{x1:e*i.BRICK_WIDTH+this.g.render.mapDx,y1:t*i.BRICK_HEIGHT+this.g.render.mapDy,x2:e*i.BRICK_WIDTH+i.BRICK_WIDTH+this.g.render.mapDx,y2:t*i.BRICK_HEIGHT+i.BRICK_HEIGHT+this.g.render.mapDy}}getRows(){return this.cols}getCols(){return this.rows}getRandomRespawn(){return this.respawns[d.random(0,respawns.length)]}}var B={keyUp:!1,keyDown:!1,keyLeft:!1,keyRight:!1,keyTab:!1,onKeyUp:function(t,e){j.push({event:"keyup",keyCode:t,f:e})}},j=[];document.addEventListener("keydown",t=>{if("textarea"!==t.target.nodeName.toLowerCase()){switch(t.preventDefault(),t.keyCode){case 38:B.keyUp=!0;break;case 37:B.keyLeft=!0;break;case 39:B.keyRight=!0;break;case 40:B.keyDown=!0;break;case 9:B.keyTab=!0}for(var e=0;e<j.length;e++)"keydown"==j[e].event&&t.keyCode==j[e].keyCode&&j[e].f()}}),document.addEventListener("keyup",t=>{if("textarea"!==t.target.nodeName.toLowerCase()){switch(t.preventDefault(),t.keyCode){case 38:B.keyUp=!1;break;case 37:B.keyLeft=!1;break;case 39:B.keyRight=!1;break;case 40:B.keyDown=!1;break;case 9:B.keyTab=!1}for(var e=0;e<j.length;e++)"keyup"==j[e].event&&t.keyCode==j[e].keyCode&&j[e].f()}});var G=B,W=s(1),F=s.n(W);class V extends c{constructor(t,e,s,i,a){super(t,0,0),this.texture=t.resources[s].spritesheet.animations[s+"/"+a+i],this.animated=!0,this.frameStart=1,this.container=e,this.spawn(),this.sprite.anchor.set(.5),this.sprite.animationSpeed=.3}handleCollisions(t){return!1}}class X{constructor(t,e){this.g=t,this.stage=t.render.stage,this.player=e,this.container=new F.a.Container,console.log("c1",this.container),this.stage.addChild(this.container),this.obj=null,this.animations=this.g.initPlayerModels(this.container),this.updateModel(),this.playerPowerup=new F.a.Text(e.displayName,{fontFamily:"Arial",fontSize:14,fontWeight:"bold",fill:"red",align:"center"}),this.playerPowerup.anchor=new F.a.Point(.5,.5),this.playerPowerup.y-=64,this.container.addChild(this.playerPowerup),this.playerName=new F.a.Text(e.displayName,{fontFamily:"Arial",fontSize:14,fill:"white",align:"center"}),this.playerName.anchor=new F.a.Point(.5,.5),this.playerName.y-=50,this.container.addChild(this.playerName),this.playerHA=new F.a.Text("0 / 0",{fontFamily:"Arial",fontSize:12,fill:"white",align:"center"}),this.playerHA.anchor=new F.a.Point(.5,.5),this.playerHA.y-=36,this.container.addChild(this.playerHA),this.mech=this.g.render.createMech(0,0,this.player.width(),this.player.height()),this.mech.visible=!1}updateModel(){for(var t in this.animations)for(var e in this.animations[t])for(var s=0;s<this.animations[t][e].length;s++)this.animations[t][e][s].sprite.visible=!1;var i=this.player.crouch?1:0;this.player.dead>0&&(i=2,console.log("dead "+i)),this.obj=this.animations[this.player.model][this.player.modelColor][i].sprite,this.obj.visible=!0,this.play()}play(){this.obj.playing||this.obj.gotoAndPlay(0)}stop(){this.obj.playing&&this.obj.gotoAndStop(0)}adjustPosition(t,e){this.player.dead||this.player.dir!=i.DIR_LS&&this.player.dir!=i.DIR_RS?this.play():this.stop(),this.container.scale.x=this.player.dir==i.DIR_LS||this.player.dir==i.DIR_LW?-1:1,this.playerName.scale.x=this.playerHA.scale.x=this.playerPowerup.scale.x=this.container.scale.x,this.container.x=t,this.player.crouch&&(e+=5),this.container.y=e,this.playerHA.text=this.player.health+" / "+this.player.armor,this.setPowerupString(),this.player.weapon.sprite.angle=this.player.fangle,this.player.flag&&(this.player.flag.setY(this.player.y),this.player.dir==i.DIR_RW||this.player.dir==i.DIR_RS?(this.player.flag.setX(this.player.x-20),this.player.flag.sprite.scale.x=-1,this.player.flag.sprite.angle=-45):(this.player.flag.setX(this.player.x+20),this.player.flag.sprite.scale.x=1,this.player.flag.sprite.angle=45))}updatePlayerHA(t,e,s){}setPowerupString(){if(0!=this.player.powerups.length){var t="[";for(var e in this.player.powerups){switch(this.player.powerups[e]){case i.IT_POWERUP_REGENERATION:t+="REGENERATION";break;case i.IT_POWERUP_BATTLESUIT:t+="BATTLESUIT";break;case i.IT_POWERUP_HASTE:t+="HASTE";break;case i.IT_POWERUP_QUAD:t+="QUAD";break;case i.IT_POWERUP_FLIGHT:t+="FLIGHT";break;case i.IT_POWERUP_INVISIBILITY:t+="INVISIBILITY"}t+=" |"}t=d.trimChars(t," |"),t+="]",this.playerPowerup.text=t}else this.playerPowerup.text=""}destroy(){this.stage.removeChild(this.obj),this.stage.removeChild(this.playerCenter),this.stage.removeChild(this.playerName),this.stage.removeChild(this.playerHA),this.stage.removeChild(this.mech)}}const Y=i.PLAYER_MAX_VELOCITY_X;var K=d.trunc,J=0,z=document.getElementById("log"),q="";class Q{constructor(t,e){this.g=t,this.player=e,this.map=t.map,this.defx=0,this.defy=0,this.tmpCol=0,this.tmpY=0,this.tmpSpeedX=0,this.tmpAbsMaxVelocityX=0,this.tmpSign=0,this.velocityYSpeedJump=[0,0,.4,.8,1,1.2,1.4],this.velocityXSpeedJump=[0,.33,.8,1.1,1.4,1.8,2.2],this.tmpLastWasJump=!1,this.tmpCurJump=!1,this.speedJumpDirection=0,this.tmpLastKeyUp=!1,this.tmpDjBonus=0,this.time=0,this.tmpDeltaTime=0,this.tmpDeltaPhysicFrames=0}playerphysic(t){this.defx=this.player.x,this.defy=this.player.y,this.player.velocityY=this.player.velocityY+.056,this.player.velocityY>-1&&this.player.velocityY<0&&(this.player.velocityY/=1.11),this.player.velocityY>0&&this.player.velocityY<5&&(this.player.velocityY*=1.1),this.player.velocityX<-.2||this.player.velocityX>.2?this.player.keyLeft===this.player.keyRight&&(this.player.isOnGround()?this.player.velocityX/=1.14:this.player.velocityX/=1.025):this.player.velocityX=0,0!==this.player.velocityX?this.tmpSpeedX=(this.player.velocityX<0?-1:1)*this.velocityXSpeedJump[this.player.speedJump]:this.tmpSpeedX=0,this.player.setXY(this.player.x+this.player.velocityX+this.tmpSpeedX,this.player.y+this.player.velocityY),this.player.crouch&&(this.player.isOnGround()&&(this.player.isBrickCrouchOnHead()||this.player.velocityY>0)?(this.player.velocityY=0,this.player.setY(16*K(Math.round(this.player.y)/16)+8)):this.player.isBrickCrouchOnHead()&&this.player.velocityY<0&&(this.player.velocityY=0,this.player.doublejumpCountdown=3,this.player.setY(16*K(Math.round(this.player.y)/16)+8))),0!=this.player.velocityX&&(this.tmpCol=K(Math.round(this.defx+(this.player.velocityX<0?-11:11))/32),this.tmpY=this.player.crouch?this.player.y:this.defy,(this.map.isBrick(this.tmpCol,K(Math.round(this.tmpY-(this.player.crouch?8:16))/16))||this.map.isBrick(this.tmpCol,K(Math.round(this.tmpY)/16))||this.map.isBrick(this.tmpCol,K(Math.round(this.tmpY+16)/16)))&&(this.player.setX(32*K(this.defx/32)+(this.player.velocityX<0?9:22)),this.player.velocityX=0,this.player.speedJump=0,this.defx!=this.player.x&&this.log("wall",this.player))),this.player.isOnGround()&&(this.player.isBrickOnHead()||this.player.velocityY>0)?(this.player.velocityY=0,this.player.setY(16*K(Math.round(this.player.y)/16)+8)):t.isBrickOnHead()&&this.player.velocityY<0&&(this.player.velocityY=0,this.player.doublejumpCountdown=3),this.player.velocityX<-5&&(this.player.velocityX=-5),this.player.velocityX>5&&(this.player.velocityX=5),this.player.velocityY<-5&&(this.player.velocityY=-5),this.player.velocityY>5&&(this.player.velocityY=5)}playermove(){if(this.playerphysic(this.player),this.player.doublejumpCountdown>0&&this.player.doublejumpCountdown--,this.player.isOnGround()&&(this.player.velocityY=0),!this.g.demo&&(this.tmpCurJump=!1,this.player.speedJump>0&&(this.player.keyUp!==this.tmpLastKeyUp||this.player.keyLeft&&-1!==this.speedJumpDirection||this.player.keyRight&&1!==this.speedJumpDirection)&&(this.player.speedJump=0,this.log("sj 0 - change keys",this.player)),this.tmpLastKeyUp=this.player.keyUp,this.player.keyUp?!this.player.isOnGround()||this.player.isBrickOnHead()||this.tmpLastWasJump||(this.player.doublejumpCountdown>4&&this.player.doublejumpCountdown<11?(this.player.doublejumpCountdown=14,this.player.velocityY=-3,0!==this.player.velocityX?this.tmpSpeedX=Math.abs(this.player.velocityX)+this.velocityXSpeedJump[this.player.speedJump]:this.tmpSpeedX=0,this.tmpSpeedX>3?(this.tmpDjBonus=this.tmpSpeedX-3,this.player.velocityY-=this.tmpDjBonus,this.log("dj higher (bonus +"+this.round(this.tmpDjBonus)+")",this.player)):this.log("dj standart",this.player),this.player.setCrouch(!1),w.jump()):(0===this.player.doublejumpCountdown&&(this.player.doublejumpCountdown=14,w.jump()),this.player.velocityY=-2.9,this.player.velocityY+=this.velocityYSpeedJump[this.player.speedJump],this.log("jump",player),this.player.speedJump<6&&!this.tmpLastWasJump&&this.player.keyLeft!==this.player.keyRight&&(this.speedJumpDirection=this.player.keyLeft?-1:1,this.player.speedJump++,this.log("increase sj",this.player))),this.tmpCurJump=!0):this.player.isOnGround()&&this.player.speedJump>0&&!this.player.keyDown&&(this.player.speedJump=0,this.log("sj 0 - on ground",this.player)),!this.player.keyUp&&this.player.keyDown?this.player.isOnGround()?this.player.setCrouch(!0):this.player.isBrickCrouchOnHead()||this.player.setCrouch(!1):this.player.setCrouch(this.player.isOnGround()&&this.player.isBrickCrouchOnHead()),this.tmpLastWasJump=this.tmpCurJump,this.player.keyLeft!==this.player.keyRight)){this.tmpAbsMaxVelocityX=Y,this.player.crouch&&this.tmpAbsMaxVelocityX--,this.tmpSign=this.player.keyLeft?-1:1,this.player.velocityX*this.tmpSign<0&&(this.player.velocityX+=.8*this.tmpSign);var t=Math.abs(this.player.velocityX);t<this.tmpAbsMaxVelocityX?this.player.velocityX+=.35*this.tmpSign:t>this.tmpAbsMaxVelocityX&&(this.player.velocityX=this.tmpSign*this.tmpAbsMaxVelocityX)}}runPhysicsOneFrame(t){this.playermove()}updateGame(t){if(0===this.time&&(this.time=t-16),this.tmpDeltaTime=t-this.time,this.tmpDeltaPhysicFrames=K(this.tmpDeltaTime/16),0===this.tmpDeltaPhysicFrames)return!1;if(this.time+=16.6*this.tmpDeltaPhysicFrames,1===this.tmpDeltaPhysicFrames)this.runPhysicsOneFrame();else for(;this.tmpDeltaPhysicFrames>0;)this.runPhysicsOneFrame(),this.tmpDeltaPhysicFrames--}log(t){J++,0!==this.player.velocityX?this.tmpSpeedX=(this.player.velocityX<0?-1:1)*this.velocityXSpeedJump[pthis.layer.speedJump]:this.tmpSpeedX=0,q=J+" "+t+" (x: "+this.round(this.player.x)+", y: "+this.round(this.player.y)+", dx: "+this.round(this.tmpSpeedX)+", dy: "+this.round(this.player.velocityY)+", sj: "+this.player.speedJump+")",z.value=q+"\n"+z.value.substring(0,1e3)}round(t){return K(t)+"."+Math.abs(K(10*t)-10*K(t))}}class $ extends c{constructor(t,e,s,a){super(t,s,a),this.player=e,this.DXID=d.random(1,9999999),this.inertialX=0,this.inertialY=0,this.speed=0,this.dir=i.DIR_RS,this.anchor=.5,this.explosion=null}spawn(){if(super.spawn(),this.g.objects.push(this),this.sprite.scale.x*=this.dir==i.DIR_LS?-1:1,this.bullet){var t=this,e=this.g.timerManager.addTickTimer(1,0,(function(e,s){var a=t.x+t.speed*Math.cos(t.rotation),r=t.y+t.speed*Math.sin(t.rotation);t.dir==i.DIR_LS&&(a=t.x-t.speed*Math.cos(t.rotation)),t.setX(a),t.setY(r)}));this.timerIds.push(e)}}handleCollisions(t){if(!this.bullet)return!1;var e=this;return super.handleCollisions(t,(function(t){return e.player.DXID!=t.DXID&&(e.explode(),e.destroy(),!0)}))}handleBrickCollisions(t){if(!this.bullet)return!1;var e=this;return super.handleCollisions(t,(function(t){return e.explode(),e.destroy(),!0}))}explode(){if(this.explosion){this.expl=new c(this.g,this.x,this.y),this.expl.texture=this.explosion,this.expl.animated=!0,this.expl.animationSpeed=.3,this.expl.anchor=.5;var t=this;this.expl.animateOneTime=function(){t.expl.destroy()},this.expl.spawn()}}destroy(){super.destroy();for(var t=0;t<this.g.objects.length;t++)if(this.g.objects[t].DXID==this.DXID){this.g.objects.splice(t,1);break}}}class Z extends c{constructor(t,e){super(t,0,0),this.g=t,this.player=e,this.offsetX=-1,this.offsetY=-6,this.bullet="",this.ammo=0,this.maxAmmo=0}spawn(){super.spawn(),this.sprite.anchor.set(.35,.5)}addAmmo(t){this.ammo+=t,this.ammo>this.maxAmmo&&(this.ammo=this.maxAmmo)}handleCollisions(t,e){return!1}fire(t,e,s,i){this.newBullet&&this.newBullet(t,e,s,i).spawn()}fireVector(t,e,s,i,a,r){this.newBullet&&this.newBullet(t,e,s,i,a,r).spawn()}}class tt extends Z{constructor(t,e){super(t,e),this.itemId=i.C_WPN_GAUNTLET,this.offsetX=-1,this.texture=t.resources.gauntlet.spritesheet.animations.gauntlet,this.animated=!0,this.frameStopped=0,this.frameStart=1,this.frameEnd=3,this.container=e.graphics.container,this.offsetX=-8}use(t){this.play(),console.log(t),w.play("fire_gauntl"+t)}}class et extends Z{constructor(t,e){super(t,e),this.itemId=i.C_WPN_MACHINE,this.ammo=100,this.maxAmmo=100,this.texture=t.resources.mgun.spritesheet.animations.mgun,this.animated=!0,this.animateOneTime=()=>{},this.container=e.graphics.container}newBullet(t,e,s,i,a,r){return new st(this.g,this.player,t,e)}fireVector(t,e,s,i,a,r){super.fireVector(t,e,s,i,a,r),w.play("fire_mach"),this.sprite.play()}}class st extends ${constructor(t,e,s,i){super(t,e,s,i),this.width=this.height=16,this.texture=t.resources.bullets.spritesheet.animations.tile,this.animated=!0,this.animationSpeed=.05,this.frameStart=0,this.frameEnd=2;var a=this;this.animateOneTime=function(){a.destroy()}}}class it extends Z{constructor(t,e){super(t,e),this.itemId=i.C_WPN_SHOTGUN,this.ammo=10,this.maxAmmo=50,this.texture=t.resources.weapons.textures["weapons-"+(this.itemId-2)+".png"],this.container=e.graphics.container}newBullet(t,e,s,i,a,r){return new at(this.g,this.player,t,e)}fireVector(t,e,s,i,a,r){super.fireVector(t,e,s,i,a,r),w.play("fire_shotgun")}}class at extends ${constructor(t,e,s,i){super(t,e,s,i),this.width=this.height=16,this.texture=t.resources.bullets.spritesheet.animations.tile,this.animated=!0,this.animationSpeed=.05,this.frameStart=0,this.frameEnd=2;var a=this;this.animateOneTime=function(){a.destroy()}}}class rt extends Z{constructor(t,e){super(t,e),this.itemId=i.C_WPN_GRENADE,this.ammo=10,this.maxAmmo=50,this.texture=t.resources.weapons.textures["weapons-"+(this.itemId-2)+".png"],this.container=e.graphics.container}fireVector(t,e,s,i){w.play("fire_gren"),super.fire(t,e,s,i)}}class ht extends Z{constructor(t,e){super(t,e),this.itemId=i.C_WPN_ROCKET,this.ammo=10,this.maxAmmo=50,this.texture=t.resources.weapons.textures["weapons-"+(this.itemId-2)+".png"],this.container=e.graphics.container}newBullet(t,e,s,i){return new ot(this.g,this.player,t,e,s,i)}fire(t,e,s,i){super.fire(t,e,s,i),w.play("fire_rocket")}}class ot extends ${constructor(t,e,s,a,r,h){super(t,e,s,a),this.g=t,this.bullet=!0,this.inertialX=r,this.inertialY=h,this.width=7,this.height=7,this.rotation=e.weapon.sprite.rotation,e.dir!=i.DIR_LS&&e.dir!=i.DIR_LW||(this.dir=i.DIR_LS),this.speed=6,this.texture=t.resources.bullets.textures["tile005.png"],this.explosion=t.resources.explosion.spritesheet.animations.explosion}spawn(){super.spawn(),this.glow=new c(this.g,0,0),this.glow.anchor=.5,this.glow.offsetX=-8,this.glow.texture=this.g.resources.glow.texture,this.glow.container=this.sprite,this.glow.spawn()}}class nt extends Z{constructor(t,e){super(t,e),this.g=t,this.itemId=i.C_WPN_SHAFT,this.ammo=10,this.maxAmmo=50,this.texture=t.resources.weapons.textures["weapons-"+(this.itemId-2)+".png"],this.container=e.graphics.container}spawn(){super.spawn();var t=new PIXI.Graphics;t.lineStyle(3,16777215),t.moveTo(20,0),t.lineTo(150,0),t.endFill(),this.fireObject=new c(this.g,0,0),this.fireObject.sprite=t,this.fireObject.container=this.sprite,this.fireObject.spawn(),this.fireObject.hide()}fire(t){this.fireObject.show(),w.play("fire_shaft_begin")}stop(){this.fireObject.hide(),w.play("fire_shaft_end")}}class lt extends Z{constructor(t,e){super(t,e),this.itemId=i.C_WPN_RAIL,this.ammo=10,this.maxAmmo=50,this.texture=t.resources.weapons.textures["weapons-"+(this.itemId-2)+".png"],this.container=e.graphics.container}newBullet(t,e,s,i,a,r){return new pt(this.g,this.player,t,e,a,r)}fireVector(t,e,s,i,a,r){super.fireVector(t,e,s,i,a,r),w.play("fire_rail")}}class pt extends ${constructor(t,e,s,i,a,r){super(t,e,a,r),this.srcX=s,this.srcY=i,this.width=this.height=16,this.texture=t.resources.railhit.texture;var h=this;this.fadeOut(.01,(function(){h.destroy()}))}spawn(){super.spawn();var t=new PIXI.Graphics;t.lineStyle(2,16777215),t.moveTo(this.srcX,this.srcY),t.lineTo(this.x,this.y),t.endFill(),this.fireObject=new c(this.g,0,0),this.fireObject.sprite=t,this.fireObject.spawn();var e=this;this.fireObject.fadeOut(.08,(function(){e.fireObject.destroy()}))}}class dt extends Z{constructor(t,e){super(t,e),this.itemId=i.C_WPN_PLASMA,this.ammo=10,this.maxAmmo=50,this.texture=t.resources.weapons.textures["weapons-"+(this.itemId-2)+".png"],this.container=e.graphics.container}newBullet(t,e,s,i){return new ct(this.g,this.player,t,e,s,i)}fire(t,e,s,i){super.fire(t,e,s,i),w.play("fire_plasma")}}class ct extends ${constructor(t,e,s,a,r,h){super(t,e,s,a),this.bullet=!0,this.inertialX=r,this.inertialY=h,this.width=this.height=1,this.rotation=e.weapon.sprite.rotation,e.dir!=i.DIR_LS&&e.dir!=i.DIR_LW||(this.dir=i.DIR_LS),this.speed=6,this.texture=t.resources.bullets.textures["tile007.png"]}}class ut extends Z{constructor(t,e){super(t,e),this.itemId=i.C_WPN_BFG,this.ammo=10,this.maxAmmo=50,this.texture=t.resources.weapons.textures["weapons-"+(this.itemId-2)+".png"],this.container=e.graphics.container}newBullet(t,e,s,i){return new mt(this.g,this.player,t,e,s,i)}fire(t,e,s,i){super.fire(t,e,s,i),w.play("fire_bfg")}}class mt extends ${constructor(t,e,s,a,r,h){super(t,e,s,a),this.g=t,this.bullet=!0,this.inertialX=r,this.inertialY=h,this.width=13,this.height=7,this.rotation=e.weapon.sprite.rotation,e.dir!=i.DIR_LS&&e.dir!=i.DIR_LW||(this.dir=i.DIR_LS),this.speed=6,this.texture=t.resources.bullets.textures["tile015.png"],this.explosion=t.resources.explosion.spritesheet.animations.explosion}spawn(){super.spawn(),this.glow=new c(this.g,0,0),this.glow.anchor=.5,this.glow.offsetX=-8,this.glow.texture=this.g.resources.glow.texture,this.glow.container=this.sprite,this.glow.spawn()}}class gt{constructor(t,e,s){for(var a in this.g=t,this.stage=t.render.stage,this.map=t.map,this.DXID=e,this.x=0,this.y=0,this.name=windows1251.decode(s),this.displayName=d.filterNickName(this.name),this.health=0,this.armor=0,this.frags=0,this.ping="0",this.follow=!1,this.velocityX=0,this.velocityY=0,this.crouch=!1,this.dir=i.DIR_RS,this.dead=0,this.BALLOON=!1,this.team=i.C_TEAMNON,this.model="sarge",this.modelColor="default",this.rewardtime=0,this.fangle=0,this.ammo_mg=100,this.ammo_sg=0,this.ammo_gl=0,this.ammo_rl=0,this.ammo_sh=0,this.ammo_rg=0,this.ammo_pl=0,this.ammo_bfg=0,this.keyUp=!1,this.keyDown=!1,this.keyLeft=!1,this.keyRight=!1,this.doublejumpCountdown=0,this.cacheOnGround=!1,this.cacheBrickOnHead=!1,this.cacheBrickCrouchOnHead=!1,this.speedJump=0,this.graphics=null,this.physics=null,this.flag=null,this._init(),this.powerups=[],this.weapons=[new tt(this.g,this),new et(this.g,this),new it(this.g,this),new rt(this.g,this),new ht(this.g,this),new nt(this.g,this),new lt(this.g,this),new dt(this.g,this),new ut(this.g,this)],this.weapon=this.weapons[0],this.weapons)this.weapons[a].spawn()}_init(){this.graphics=new X(this.g,this),this.physics=new Q(this.g,this)}height(){return this.crouch?i.PLAYER_HEIGHT_CROUCH:i.PLAYER_HEIGHT}width(){return i.PLAYER_WIDTH}rect(){return{x1:this.x-this.width()/2+this.g.render.mapDx,y1:this.y-this.height()/2+this.g.render.mapDy+1+(this.crouch?i.BRICK_HEIGHT/2:0),x2:this.x+this.width()/2+this.g.render.mapDx,y2:this.y+this.height()/2+this.g.render.mapDy+1+(this.crouch?i.BRICK_HEIGHT/2:0)}}setModel(t,e){this.model=t,this.modelColor=e,this.graphics.animations[this.model]||(this.model="sarge",console.log("reset model (model not found "+t+")")),this.graphics.animations[this.model][this.modelColor]||(this.modelColor="default",console.log("reset color (model not found "+t+"+"+e+")")),this.graphics.updateModel()}addHealth(t,e){this.health+=t,this.health>e&&(this.health=e),this.health<=0&&this.setDead(1)}addArmor(t){this.admor+=t,this.admor>200&&(this.admor=200)}addWeapon(t){}addWeaponAmmo(t,e){}setWeapon(t){for(var e in this.weapons)this.weapons[e].hide();this.weapon=this.weapons[t],0==this.dead&&this.weapon.show()}setCrouch(t){this.crouch!=t&&(this.crouch=t,this.graphics.updateModel())}setDead(t){this.dead!=t&&(this.dead=t,this.graphics.updateModel(),this.dead>0&&(w.playDeath(this),this.weapon.hide()),this.flag&&(this.flag=null),this.powerups=[])}changeTeam(t){console.log("player "+this.name+" selected team "+t),this.team=t,this.setModel(this.model,t==i.C_TEAMRED?"red":t==i.C_TEAMBLUE?"blue":i.C_TEAMNON),this.graphics.updateModel()}setX(t){t!=this.x&&(this.x=t,this.updateCaches())}setY(t){t!=this.y&&(this.y=t,this.updateCaches())}setXY(t,e){t===this.x&&e===this.y||(this.x=t,this.y=e,this.updateCaches())}addPowerup(t){if(-1==this.powerups.indexOf(t)){this.powerups.push(t);this.powerups.length;var e=this;this.g.timerManager.addTimeout(30,(function(){for(var s=0;s<e.powerups.length;s++)if(e.powerups[s]==t){e.powerups.splice(s,1);break}}))}}jump(){w.playModel(this.model,"jump")}updateCaches(){this.updateCacheOnGround(),this.updateCacheBrickOnHead(),this.updateCacheBrickCrouchOnHead()}updateCacheOnGround(){this.cacheOnGround=this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y+25)/16))&&!this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y+23)/16))||this.map.isBrick(d.trunc(d.trunc(this.x+9)/32),d.trunc(d.trunc(this.y+25)/16))&&!this.map.isBrick(d.trunc(d.trunc(this.x+9)/32),d.trunc(d.trunc(this.y+23)/16))||this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y+24)/16))&&!this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y+8)/16))||this.map.isBrick(d.trunc((this.x+9)/32),d.trunc((this.y+24)/16))&&!this.map.isBrick(d.trunc((this.x+9)/32),d.trunc((this.y+8)/16))}updateCacheBrickCrouchOnHead(){this.cacheBrickCrouchOnHead=this.map.isBrick(d.trunc((this.x-8)/32),d.trunc((this.y-9)/16))&&!this.map.isBrick(d.trunc((this.x-8)/32),d.trunc((this.y-7)/16))||this.map.isBrick(d.trunc((this.x+8)/32),d.trunc((this.y-9)/16))&&!this.map.isBrick(d.trunc((this.x+8)/32),d.trunc((this.y-7)/16))||this.map.isBrick(d.trunc((this.x-8)/32),d.trunc((this.y-23)/16))||this.map.isBrick(d.trunc((this.x+8)/32),d.trunc((this.y-23)/16))||this.map.isBrick(d.trunc((this.x-8)/32),d.trunc((this.y-16)/16))||this.map.isBrick(d.trunc((this.x+8)/32),d.trunc((this.y-16)/16))}updateCacheBrickOnHead(){this.cacheBrickOnHead=this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y-25)/16))&&!this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y-23)/16))||this.map.isBrick(d.trunc((this.x+9)/32),d.trunc((this.y-25)/16))&&!this.map.isBrick(d.trunc((this.x+9)/32),d.trunc((this.y-23)/16))||this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y-24)/16))&&!this.map.isBrick(d.trunc((this.x-9)/32),d.trunc((this.y-8)/16))||this.map.isBrick(d.trunc((this.x+9)/32),d.trunc((this.y-24)/16))&&!this.map.isBrick(d.trunc((this.x+9)/32),d.trunc((this.y-8)/16))}isOnGround(){return this.cacheOnGround}isBrickOnHead(){return this.cacheBrickOnHead}isBrickCrouchOnHead(){return this.cacheBrickCrouchOnHead}destroy(){this.graphics.destroy()}}class yt extends F.a.Graphics{constructor(t,e,s){super(),this.color=16711935,this.loadColor=16777215,this.lineStyle(1,this.color,.5,.5,!0),this.beginFill(this.color,.1),this.drawRect(0,0,500,18),this.loaded=!0,this.elapsed=new F.a.Graphics,this.elapsed.beginFill(this.color,.4),this.elapsed.drawRect(0,5,1,8),this.addChild(this.elapsed),this.elapsedLoading=new F.a.Graphics,this.elapsedLoading.beginFill(this.loadColor,.5),this.elapsedLoading.drawRect(0,5,1,8),this.elapsedLoading.visible=!1,this.addChild(this.elapsedLoading),this.button=new F.a.Graphics,this.button.beginFill(this.color,.6),this.button.drawCircle(9,9,6),this.addChild(this.button),this.tooltip=new F.a.Text("00:00",{fontFamily:"Arial",fontSize:11,fill:"white",align:"center"}),this.tooltip.anchor=new F.a.Point(.5,.5),this.tooltip.x=0,this.tooltip.y=-10,this.tooltip.visible=!1,this.addChild(this.tooltip),this.resize(t),this.initWidth=this.width=500,this.initHeight=this.height,this.value=0,this.minValue=0,this.setMaxValue(10),this.callback=e,this.callback_tooltip=s}show(t=!1){return this.visible=!0,t&&(this.alpha=1),this}onmousedown(t){return!!this.onmousebounds(t)&&(this.mousedown=!0,this.onmousebounds_button(t)&&(this.mousedown_button=!0),this.onmousemove(t),!0)}onmouseup(t){return!!this.mousedown&&(this.mousedown=!1,this.mousedown_button=!1,!0)}onmousemove(t){if(this.onmousebounds(t)){var e=this._getValueFromAbsX(t.clientX);this.setTooltip(this.callback_tooltip(e)),this.tooltip.visible=!0,this.tooltip.x=t.clientX-this.x}else this.tooltip.visible=!1;if(this.mousedown){var s=t.clientX-this.button.width/2;return this.setValue(this._getValueFromAbsX(s)),!0}return!1}onmousebounds(t){return t.clientX>=this.x&&t.clientX<=this.x+this.initWidth&&t.clientY>=this.y&&t.clientY<=this.y+this.initHeight}onmousebounds_button(t){return t.clientX>=this.x+this.button.x&&t.clientX<=this.x+this.button.x+this.button.width&&t.clientY>=this.y+this.button.y&&t.clientY<=this.y+this.button.y+this.button.height}setMaxValue(t){this.interval=this.initWidth/t,console.log("slider interval",this.interval)}setValue(t){t<=this.minValue&&(t=this.minValue),t>this.maxValue&&(t=this.maxValue),this.value!=t&&(this.value=t,this.onChange())}getValue(){return this.value}setTooltip(t){this.tooltip.text=t}getTooltip(){return this.tooltip.text}onChange(){var t=this.getValue()*this.interval;t>this.initWidth-this.button.width&&(t=this.initWidth-this.button.width),this.button.x=t,this.elapsed.width=this.button.x+this.button.width/2,this.callback&&this.callback(this.getValue()),this.setLoaded(!1)}_getValueFromAbsX(t){return t<this.x&&(t=this.x),t>this.x+this.initWidth-this.button.width&&(t=this.x+this.initWidth-this.button.width),t-=this.x+1,Math.round(t/this.interval)}setLoaded(t){t&&!this.loaded&&(this.loaded=!0,this.elapsedLoading.visible=!1,this.elapsed.visible=!0),!t&&this.loaded&&(this.loaded=!1,this.elapsedLoading.width=this.elapsed.width,this.elapsedLoading.visible=!0,this.elapsed.visible=!1)}getLoaded(){return this.loaded}resize(t){this.x=t.app.view.width/2-this.width/2,this.y=t.app.view.height-40}}class _t{constructor(t){this.g=t,this.map=t.map;var e=this;this.app=new F.a.Application(window.innerWidth,window.innerHeight,{antialias:!1,resolution:1,transparent:!0}),this.app.view.style.display="block";var s=document.getElementById("game");s.appendChild(this.app.view),this.stage=this.app.stage,this.mapGraphics=new F.a.Graphics,this.mapGraphics.beginFill(10066329),this.mapGraphics.lineStyle(1,11184810),this.stage.addChild(this.mapGraphics),this.floatCamera=!1,this.halfWidth=0,this.halfHeight=0,this.mapDx=0,this.mapDy=0,this.bricksPerLine=8,this.paletteCustomTexture=null,this.bricksPerLineCustom=0,this.slider=new yt(this,(function(t){e.g.demo.setFrameId(t)}),(function(t){var s="00:00";if(t>0&&e.g.demo.data&&e.g.demo.data.DemoUnits&&e.g.demo.data.DemoUnits[t]){var i=e.g.demo.data.DemoUnits[t].DData.gametime;s=d.formatGameTime(i)}return s})),this.app.stage.addChild(this.slider),window.addEventListener("resize",(function(){e.recalcFloatCamera(e)}),!1),s.onmousemove=function(t){e.slider.onmousemove(t)},s.onmouseup=function(t){e.slider.onmouseup(t)},s.onmousedown=function(t){if(!e.slider.onmousedown(t)){for(var s=-1,i=0;i<e.g.players.length;i++)e.g.players[i].follow&&(e.g.players[i].follow=!1,(s=i+1)>e.g.players.length-1&&(s=0));-1!=s&&(e.g.players[s].follow=!0,console.log("Follow player "+e.g.players[s].displayName))}}}async updatePaletteTexture(t){this.paletteCustomTexture=F.a.BaseTexture.from(t);var e=await d.getImageDimensions(t);this.bricksPerLineCustom=Math.floor(e.w/i.BRICK_WIDTH),console.log("palette loaded = "+this.paletteCustomTexture.hasLoaded),console.log("change palette. Brickes per line "+this.paletteCustomTexture.width+" "+this.bricksPerLineCustom)}renderMap(){document.body.style.background="url('images/bg_"+this.map.bg+".jpg')";var t=this;this.g.map.destroyBrickObjects();var e,s,a=this.map.getRows(),r=this.map.getCols();for(e=0;e<a;e++)for(s=0;s<r;s++)if(this.map.isBrick(s,e)){var h=this.map.getBrick(s,e),o=this.g.resources.palette.texture,n=this.bricksPerLine;null!=this.map.paletteCustomImage&&h>53&&h<=181?(o=this.paletteCustomTexture,n=this.bricksPerLineCustom,h-=this.map.paletteCustomIndex):h-=this.map.paletteIndex;var l=new F.a.Texture(o,new F.a.Rectangle(h%n*i.BRICK_WIDTH,Math.floor(h/n)*i.BRICK_HEIGHT,i.BRICK_WIDTH,i.BRICK_HEIGHT)),p=new F.a.Sprite(l);p.position.x=s*i.BRICK_WIDTH,p.position.y=e*i.BRICK_HEIGHT,this.map.brickObjects.push({idx:h,row:e,col:s,rect:function(){return t.map.brickRect(this.row,this.col)},sprite:p,mech:this.g.config.brickMech?this.g.render.createMech(0,0,i.BRICK_WIDTH,i.BRICK_HEIGHT):null}),this.mapGraphics.addChild(p)}this.map.spawnObjects(),this.recalcFloatCamera(this),this.app.render(this.stage),this.slider.setMaxValue(this.g.demo.data.DemoUnits.length)}recalcFloatCamera(t){console.log("resize event"),t.app.view.width=window.innerWidth-20,t.app.view.height=window.innerHeight,t.floatCamera=t.map.getRows()>window.innerHeight/16||t.map.getCols()>(window.innerWidth-20)/32,t.floatCamera?(t.halfWidth=Math.floor((window.innerWidth-20)/2),t.halfHeight=Math.floor(window.innerHeight/2)):(t.mapGraphics.x=t.mapDx=Math.floor((window.innerWidth-20-32*t.map.getCols())/2),t.mapGraphics.y=t.mapDy=Math.floor((window.innerHeight-16*t.map.getRows())/2)),this.slider.resize(t)}renderGame(t){var e=t.x+this.mapDx,s=t.y+this.mapDy;this.floatCamera&&t.follow&&(this.mapDx=this.mapGraphics.x=this.halfWidth-t.x,this.mapDy=this.mapGraphics.y=this.halfHeight-t.y),t.graphics.adjustPosition(e,s),this.app.render(this.stage)}renderLabels(){var t=this.g.demo.getFrameId();if(this.slider.setValue(t),this.g.demo.data.DemoUnits&&this.g.demo.data.DemoUnits[t]){var e=this.g.demo.data.DemoUnits[t].DData.gametime;e!=this.g.gamestate.gametime&&e-1!=this.g.gamestate.gametime&&e+1!=this.g.gamestate.gametime||this.slider.setLoaded(!0)}this.g.labels.adjustPosition()}renderMech(){for(var t=0;t<this.g.players.length;t++)this.g.players[t].graphics.mech.x=this.g.players[t].rect().x1,this.g.players[t].graphics.mech.y=this.g.players[t].rect().y1,this.g.players[t].graphics.mech.width=this.g.players[t].rect().x2-this.g.players[t].rect().x1,this.g.players[t].graphics.mech.height=this.g.players[t].rect().y2-this.g.players[t].rect().y1,this.g.players[t].graphics.mech.visible=!0;for(t=0;t<this.g.objects.length;t++)this.g.objects[t].mech.x=this.g.objects[t].rect().x1,this.g.objects[t].mech.y=this.g.objects[t].rect().y1,this.g.objects[t].mech.width=this.g.objects[t].rect().x2-this.g.objects[t].rect().x1,this.g.objects[t].mech.height=this.g.objects[t].rect().y2-this.g.objects[t].rect().y1,this.g.objects[t].mech.visible=!0;if(this.g.config.brickMech)for(t=0;t<this.g.map.brickObjects.length;t++){var e=this.g.map.brickObjects[t].rect();this.g.map.brickObjects[t].mech.x=e.x1,this.g.map.brickObjects[t].mech.y=e.y1,this.g.map.brickObjects[t].mech.width=e.x2-e.x1,this.g.map.brickObjects[t].mech.height=e.y2-e.y1,this.g.map.brickObjects[t].mech.visible=!0}}createMech(t,e,s,i){var a=new F.a.Graphics;return a.lineStyle(1,16711935,1,.5,!0),a.drawRect(t,e,s,i),a.drawRect(t,e,0,i),this.stage.addChild(a),a}removeMech(t){this.stage.removeChild(t)}}var wt=s(2),Dt=s.n(wt);class Et{constructor(t){this.g=t,this.stage=t.render.stage,this.textPause=new F.a.Text("Game Paused",{fontFamily:"Arial",fontSize:25,fill:"red",align:"center"}),this.textPause.anchor=new F.a.Point(.5,.5),this.textPause.x=window.innerWidth/2,this.textPause.y=window.innerHeight/2,this.stage.addChild(this.textPause),this.gameTime=new F.a.Text("0:00",{fontFamily:"Arial",fontSize:14,fill:"white",align:"center"}),this.gameTime.anchor=new F.a.Point(.5,.5),this.gameTime.x=window.innerWidth-145,this.gameTime.y=20,this.stage.addChild(this.gameTime),this.textUsage=new F.a.Text("ESC = pause    TAB = score board",{fontFamily:"Arial",fontSize:12,fill:"white",align:"left"}),this.textUsage.x=15,this.textUsage.y=window.innerHeight-20,this.textUsage.alpha=.5,this.stage.addChild(this.textUsage),this.scoreboard=new ft(t),this.scoreboard.container.visible=!1}adjustPosition(){this.textPause.visible=this.g.gamestate.paused,this.scoreboard.container.visible=G.keyTab||this.g.gamestate.gameend,this.textPause.visible&&d.bringToFront(this.textPause),this.scoreboard.container.visible&&(d.bringToFront(this.scoreboard.container),this.scoreboard.update()),this.gameTime.text=d.formatGameTime(this.g.gamestate.gametime)}destroy(){this.stage.removeChild(this.textPause)}}class ft{constructor(t){this.g=t,this.colorRed=F.a.utils.string2hex("#FF4500"),this.colorBlue=F.a.utils.string2hex("#00BFFF"),this.textStyle={fontFamily:"Arial",fontSize:14,fill:"white",align:"left"},this.textStyleRed={fontFamily:"Arial",fontSize:14,fontWeight:"bold",fill:this.colorRed,align:"left"},this.textStyleBlue={fontFamily:"Arial",fontSize:14,fontWeight:"bold",fill:this.colorBlue,align:"left"},this.container=new F.a.Container;this.container.x=window.innerWidth/2-250,this.container.y=window.innerHeight/2-130,this.g.render.stage.addChild(this.container),this.background=new F.a.Graphics,this.background.beginFill(0),this.background.drawRect(0,0,500,260),this.background.endFill(),this.background.alpha=.8,this.container.addChild(this.background),this.textItems=new F.a.Graphics,this.container.addChild(this.textItems),this.lastUpdated=0}update(){this.lastUpdated>=this.g.gamestate.gametime||(this.updateScoreboard(),this.lastUpdated=this.g.gamestate.gametime)}updateScoreboard(){for(var t=this.textItems.children.length-1;t>=0;t--)this.textItems.children[t].destroy(),this.textItems.removeChild(this.textItems.children[t]);var e=new F.a.Text("NAME",this.textStyleRed);e.x=30,e.y=70,this.textItems.addChild(e);var s=new F.a.Text("FRAGS",this.textStyleRed);s.x=300,s.y=70,this.textItems.addChild(s);var a=new F.a.Text("PING",this.textStyleRed);a.x=400,a.y=70,this.textItems.addChild(a);var r=0,h=0;for(t=0;t<this.g.players.length;t++){var o=90+20*t,n=this.colorRed;this.g.players[t].team==i.C_TEAMBLUE?(n=this.colorBlue,h+=this.g.players[t].frags):r+=this.g.players[t].frags;var l=new F.a.Graphics;l.beginFill(n),l.drawRect(20,o+3,5,10),l.endFill(),this.textItems.addChild(l);var p=new F.a.Text(this.g.players[t].displayName,this.textStyle);p.x=30,p.y=o,this.textItems.addChild(p);var d=new F.a.Text(this.g.players[t].frags,this.textStyle);d.x=300,d.y=o,this.textItems.addChild(d);var c=new F.a.Text(this.g.players[t].ping,this.textStyle);c.x=400,c.y=o,this.textItems.addChild(c)}var u=new F.a.Text("RED CAPTURES: "+this.g.gamestate.redscore,this.textStyleRed);u.x=150,u.y=20,this.textItems.addChild(u);var m=new F.a.Text("RED SCORE: "+r,this.textStyleRed);m.x=177,m.y=40,this.textItems.addChild(m);var g=new F.a.Text("BLUE CAPTURES: "+this.g.gamestate.bluescore,this.textStyleBlue);g.x=300,g.y=20,this.textItems.addChild(g);var y=new F.a.Text("BLUE SCORE: "+h,this.textStyleBlue);y.x=327,y.y=40,this.textItems.addChild(y)}}class Tt{constructor(t,e,s,i){this.id=t,this.tickInterval=e,this.stopAfter=s,this.callback=i,this.stop()}start(){this.enabled=!0}stop(){this.enabled=!1,this.ticks=0}tick(){this.enabled&&this.callback&&(this.ticks++%this.tickInterval==0&&this.callback(this.id,Math.floor(this.ticks/this.tickInterval)),this.stopAfter>0&&this.ticks>=this.stopAfter&&this.stop())}}class It{constructor(){this.timers=[]}addTimer(t,e,s){return this.addTickTimer(t*i.FPS,e*i.FPS,s)}addTimeout(t,e){var s=this;return this.addTickTimer(t*i.FPS,t*i.FPS*2,(function(t,i){1==i&&(e(t,i),s.removeTimer(t))}))}addTickTimer(t,e,s){var i=d.random(1,9999999),a=new Tt(i,t,e,s);return a.start(),this.timers.push(a),i}tick(){for(var t=0;t<this.timers.length;t++)this.timers[t].tick()}stopTimer(t){for(var e=0;e<this.timers.length;e++)if(this.timers[e].id==t){this.timers[e].stop();break}}startTimer(t){for(var e=0;e<this.timers.length;e++)if(this.timers[e].id==t){this.timers[e].start();break}}removeTimer(t){for(var e=0;e<this.timers.length;e++)if(this.timers[e].id==t){this.timers.splice(e,1);break}}clearTimers(){this.timers=[]}}class Pt{constructor(t){this.g=t,this.players=t.players,this.data={},this.frameId=0,this.frameStart=0,this.reqId=0}loadFromQuery(t){var e=window.location.href.slice(window.location.href.indexOf("?")+1);if(0===e.indexOf("demourl=")){var s=decodeURIComponent(e.substring(8)).replace(/\+/g," ");s=this.g.config.demoServiceUrl+s+"&type=full",p.writeText("loading demo from url "+s),this.load(s,t)}}load(t,e){var s=this;this._loadJSON(t,(function(t){d.removeHtmlElement("loading"),s.data=t,console.log("total frames "+t.DemoUnits.length),e(s)}),(function(t){d.removeHtmlElement("loading"),p.writeText("error loading demo"),console.error(t)}))}spawnPlayer(t,e){var s=new gt(this.g,t,e);return 0==this.players.length&&(s.follow=!0),this.players.push(s),s}nextFrame(t,e){if(this.frameId>this.data.DemoUnits.length-1)return this.g.gamestate.gameend||(w.play("gameend"),console.log("end of demo"),this.g.gamestate.gameend=!0),!1;var s=this.data.DemoUnits[this.frameId],a=s.DemoUnit;if(t!=s.DData.gametic)return!0;switch(this.setFrameId(this.frameId+1),this.g.gamestate.gametime=s.DData.gametime,this.g.gamestate.gametick=s.DData.gametick,s.DData.type0){case i.DDEMO_TIMESET:this.g.timerManager.clearTimers(),0==a.warmup&&(w.play("matchstart"),this.g.map.spawnObjects());break;case i.DDEMO_PLAYERPOSV3:for(var r=0;r<this.players.length;r++)if(a.DXID==this.players[r].DXID){this.players[r].x=a.x,this.players[r].y=a.y,this.players[r].velocityX=a.inertiax,this.players[r].velocityY=a.inertiay,(a.PUV3&i.PUV3_DIR0)==i.PUV3_DIR0&&(this.players[r].dir=i.DIR_LW),(a.PUV3&i.PUV3_DIR1)==i.PUV3_DIR1&&(this.players[r].dir=i.DIR_RW),(a.PUV3&i.PUV3_DIR2)==i.PUV3_DIR2&&(this.players[r].dir=i.DIR_LS),(a.PUV3&i.PUV3_DIR3)==i.PUV3_DIR3&&(this.players[r].dir=i.DIR_RS),(a.PUV3&i.PUV3_DEAD0)==i.PUV3_DEAD0&&this.players[r].setDead(0),(a.PUV3&i.PUV3_DEAD1)==i.PUV3_DEAD1&&this.players[r].setDead(1),(a.PUV3&i.PUV3_DEAD2)==i.PUV3_DEAD2&&this.players[r].setDead(2),(a.PUV3&i.PUV3_WPN0)==i.PUV3_WPN0&&this.players[r].setWeapon(i.C_WPN_GAUNTLET),(a.PUV3&i.PUV3_WPN1)==i.PUV3_WPN1&&this.players[r].setWeapon(i.C_WPN_MACHINE),(a.PUV3&i.PUV3_WPN2)==i.PUV3_WPN2&&this.players[r].setWeapon(i.C_WPN_SHOTGUN),(a.PUV3&i.PUV3_WPN3)==i.PUV3_WPN3&&this.players[r].setWeapon(i.C_WPN_GRENADE),(a.PUV3&i.PUV3_WPN4)==i.PUV3_WPN4&&this.players[r].setWeapon(i.C_WPN_ROCKET),(a.PUV3&i.PUV3_WPN5)==i.PUV3_WPN5&&this.players[r].setWeapon(i.C_WPN_SHAFT),(a.PUV3&i.PUV3_WPN6)==i.PUV3_WPN6&&this.players[r].setWeapon(i.C_WPN_RAIL),(a.PUV3&i.PUV3_WPN7)==i.PUV3_WPN7&&this.players[r].setWeapon(i.C_WPN_PLASMA),(a.PUV3B&i.PUV3B_WPN8)==i.PUV3B_WPN8&&this.players[r].setWeapon(i.C_WPN_BFG);var h=(a.PUV3B&i.PUV3B_CROUCH)==i.PUV3B_CROUCH;this.players[r].setCrouch(h),this.players[r].BALLOON=(a.PUV3B&i.PUV3B_BALLOON)==i.PUV3B_BALLOON,0==this.players[r].dead&&(a.PUV3&i.PUV3_DEAD1)==i.PUV3_DEAD1?this.players[r].graphics.stop():this.players[r].graphics.play(),this.players[r].dead>0&&(a.PUV3&i.PUV3_DEAD0)==i.PUV3_DEAD0&&this.players[r].rewardtime>0&&(this.players[r].rewardtime=0),this.players[r].fangle=1.40625*a.wpnang,this.players[r].dir==i.DIR_RW||this.players[r].dir==i.DIR_RS?(this.players[r].fangle>180&&(this.players[r].fangle=this.players[r].fangle),this.players[r].fangle-=90):(this.players[r].fangle<=180&&(this.players[r].fangle=this.players[r].fangle),this.players[r].fangle=270-this.players[r].fangle),this.players[r].ammo_mg=a.currammo,this.players[r].ammo_sg=a.currammo,this.players[r].ammo_gl=a.currammo,this.players[r].ammo_rl=a.currammo,this.players[r].ammo_sh=a.currammo,this.players[r].ammo_rg=a.currammo,this.players[r].ammo_pl=a.currammo,this.players[r].ammo_bfg=a.currammo}break;case i.DDEMO_HAUPDATE:for(r=0;r<this.players.length;r++)a.DXID==this.players[r].DXID&&(this.players[r].health=a.health,this.players[r].armor=a.armor,this.players[r].frags=a.frags);break;case i.DDEMO_CREATEPLAYERV2:var o=a.netname,n=this.spawnPlayer(a.DXID,o);console.log(a);var l=a.modelname.split("+");n.setModel(l[0],l[1]),n.changeTeam(a.team),console.log("player joined "+o);break;case i.DDEMO_TEAMSELECT:for(r=0;r<this.players.length;r++)a.DXID==this.players[r].DXID&&this.players[r].changeTeam(a.team);break;case i.DDEMO_PLAYERMODELCHANGE:for(r=0;r<this.players.length;r++)if(a.DXID==this.players[r].DXID){console.log("changemodel ",a);l=a.newstr.split("+");this.players[r].setModel(l[0],l[1])}break;case i.DDEMO_DROPPLAYER:for(var c=0;c<this.players.length;c++)this.players[c].DXID==a.DXID&&(console.log("player left "+this.players[c].name),this.players[c].destroy(),this.players.splice(c,1));break;case i.DDEMO_DAMAGEPLAYER:for(r=0;r<this.players.length;r++)a.DXID==this.players[r].DXID&&(this.players[r].health=a.health,w.playPain(this.players[r]));break;case i.DDEMO_CTF_EVENT_FLAGPICKUP:console.log("flag pickup"),a.DXID=a.PlayerDXID;case i.DDEMO_CTF_EVENT_FLAGTAKEN:w.play("flagtk");for(r=0;r<this.players.length;r++)if(a.DXID==this.players[r].DXID){var u=this.players[r].team==i.C_TEAMBLUE?i.IT_RED_FLAG:i.IT_BLUE_FLAG;for(var m in this.g.objects)if(this.g.objects[m].itemId==u){this.players[r].flag=this.g.objects[m],console.log("flag "+u+" taken by "+this.players[r].displayName);break}}break;case i.DDEMO_CTF_EVENT_FLAGRETURN:w.play("flagret");u=a.team==i.C_TEAMBLUE?i.IT_BLUE_FLAG:i.IT_RED_FLAG;for(var m in this.g.objects)if(this.g.objects[m].itemId==u){this.g.objects[m].returnToBase(),console.log("flag "+u+" returned");break}break;case i.DDEMO_CTF_EVENT_FLAGCAPTURE:w.play("flagcap");for(r=0;r<this.players.length;r++)a.DXID==this.players[r].DXID&&this.players[r].flag&&this.players[r].flag.returnToBase();break;case i.DDEMO_EARNPOWERUP:break;case i.DDEMO_CHATMESSAGE:var g="";for(c=0;c<this.players.length;c++)if(this.players[c].DXID==a.TDNETCHATMessage.DXID){g+=this.players[c].displayName+": ";break}g+=d.filterNickName(a.MessageText),p.writeText(g),w.play("talk");break;case i.DDEMO_CTF_GAMESTATE:case i.DDEMO_CTF_GAMESTATESCORE:case i.DDEMO_DOM_SCORECHANGED:this.g.gamestate.redscore=a.RedScore,this.g.gamestate.bluescore=a.BlueScore;break;case i.DDEMO_KILLOBJECT:break;case i.DDEMO_FIREBFG:case i.DDEMO_FIREROCKET:case i.DDEMO_FIREPLASMAV2:for(c=0;c<this.players.length;c++)this.players[c].DXID==a.spawnerDxid&&this.players[c].weapon.fire(a.x,a.y,a.inertiax,a.inertiay);break;case i.DDEMO_FIREGREN:case i.DDEMO_FIRERAIL:case i.DDEMO_FIRESHOTGUN:case i.DDEMO_FIREMACH:for(c=0;c<this.players.length;c++)this.players[c].DXID==a.spawnerDxid&&this.players[c].weapon.fireVector(a.x,a.y,a.cx,a.cy,a.inertiax,a.inertiay);break;case i.DDEMO_GAUNTLETSTATE:for(c=0;c<this.players.length;c++)this.players[c].DXID==a.DXID&&(console.log(a.State),0==a.State?this.players[c].weapon.stop():this.players[c].weapon.use&&this.players[c].weapon.use(a.State));break;case i.DDEMO_NEW_SHAFTBEGIN:for(c=0;c<this.players.length;c++)this.players[c].DXID==a.DXID&&this.players[c].weapon.fire(a.AMMO);break;case i.DDEMO_NEW_SHAFTEND:for(c=0;c<this.players.length;c++)this.players[c].DXID==a.DXID&&this.players[c].weapon.stop();break;case i.DDEMO_JUMPSOUND:for(c=0;c<this.players.length;c++)this.players[c].DXID==a.dxid&&this.players[c].jump();break;case i.DDEMO_JUMPPADSOUND:break;case i.DDEMO_RESPAWNSOUND:w.play("respawn");break;case i.DDEMO_LAVASOUND:w.play("lava");break;case i.DDEMO_POWERUPSOUND:for(var m in this.g.objects)this.g.objects[m].x==a.x&&this.g.objects[m].y==a.y&&this.g.objects[m].show();break;case i.DDEMO_FLIGHTSOUND:w.play("flight");break;case i.DDEMO_NOAMMOSOUND:w.play("noammo");break;case i.DDEMO_GENERICSOUNDDATA:case i.DDEMO_GENERICSOUNDSTATDATA:break;case i.DDEMO_GENERICSOUNDDATA:console.log("sound "+a.SoundType)}return this.nextFrame(t,!0),!0}setFrameId(t){t<=0&&(t=0),t>=this.data.DemoUnits.length&&(t=this.data.DemoUnits.length),this.frameId=t,this.g.gamestate.gameend=!1}getFrameId(){return this.frameId}_loadJSON(t,e,s){var i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(200===i.status?e&&e(JSON.parse(i.responseText)):s&&s(i))},i.open("GET",t,!0),i.send()}}var xt=new Dt.a;document.getElementById("fps").appendChild(xt.domElement);var bt=new class{constructor(){this.resources={},this.map=new H(this),this.render=new _t(this),this.players=[],this.demo=new Pt(this),this.objects=[],this.timerManager=new It,this.labels=new Et(this),this.gamestate={gametime:0,gametic:0,paused:!1,gameend:!1,redscore:0,bluescore:0},this.config={demoServiceUrl:"https://nfk.harpywar.com/demoparser/demo?url=",mode:"production",volume:.1,default_bg:2,mech:!0,brickMech:!1},w.setVolume(this.config.volume)}initPlayerModels(t){return{sarge:{default:this.getPlayerModels(t,"sarge","d"),red:this.getPlayerModels(t,"sarge","r"),blue:this.getPlayerModels(t,"sarge","b"),nuker:this.getPlayerModels(t,"sarge","nuker"),white:this.getPlayerModels(t,"sarge","white"),yellow:this.getPlayerModels(t,"sarge","bn"),dark:this.getPlayerModels(t,"sarge","dk")},keel:{default:this.getPlayerModels(t,"keel","d"),red:this.getPlayerModels(t,"keel","r"),blue:this.getPlayerModels(t,"keel","b"),nuker:this.getPlayerModels(t,"keel","n"),white:this.getPlayerModels(t,"keel","white1"),yellow:this.getPlayerModels(t,"keel","y"),dark:this.getPlayerModels(t,"keel","dk")},xaero:{default:this.getPlayerModels(t,"xaero","d"),red:this.getPlayerModels(t,"xaero","r"),blue:this.getPlayerModels(t,"xaero","b"),silver:this.getPlayerModels(t,"xaero","s"),white:this.getPlayerModels(t,"xaero","w"),yellow:this.getPlayerModels(t,"xaero","y"),green:this.getPlayerModels(t,"xaero","g"),dark:this.getPlayerModels(t,"xaero","dk")},crashed:{default:this.getPlayerModels(t,"crashed","d"),red:this.getPlayerModels(t,"crashed","r"),blue:this.getPlayerModels(t,"crashed","b"),green:this.getPlayerModels(t,"crashed","g")},doom2:{default:this.getPlayerModels(t,"doom2","d"),red:this.getPlayerModels(t,"doom2","r"),blue:this.getPlayerModels(t,"doom2","b"),magenta:this.getPlayerModels(t,"doom2","m"),white:this.getPlayerModels(t,"doom2","w"),yellow:this.getPlayerModels(t,"doom2","y"),green:this.getPlayerModels(t,"doom2","g"),dark:this.getPlayerModels(t,"doom2","dk"),phobos:this.getPlayerModels(t,"doom2","p")}}}getPlayerModels(t,e,s){return[new V(this,t,e,s,"w"),new V(this,t,e,s,"c"),new V(this,t,e,s,"d")]}};async function At(){await bt.map.loadFromDemo(bt.demo.data.Map),bt.render.renderMap();var t=0;requestAnimationFrame((function e(s){if(xt.begin(),!bt.gamestate.paused){for(var a=0;a<bt.players.length;a++){bt.players[a].physics.updateGame(s),bt.render.renderGame(bt.players[a]);for(var r=0;r<bt.objects.length;r++)bt.objects[r].handleCollisions(bt.players[a])}for(a=0;a<bt.map.brickObjects.length;a++)for(r=0;r<bt.objects.length;r++)bt.objects[r].handleBrickCollisions(bt.map.brickObjects[a]);bt.config.mech&&bt.render.renderMech(),bt.demo.nextFrame(t),++t>=i.FPS&&(t=0),bt.timerManager.tick()}bt.render.renderLabels(),requestAnimationFrame(e),xt.end()}))}console.log("mode: "+bt.config.mode),G.onKeyUp(27,(function(){bt.gamestate.paused=!bt.gamestate.paused})),PIXI.loader.onLoad.add((function(t,e){})),PIXI.loader.add("palette","images/palette.png").add("railhit","images/railhit.png").add("glow","images/glow.png").add("weapons","images/weapons.json").add("explosion","images/explosion.json").add("mgun","images/mgun.json").add("jumppad","images/jumppad.json").add("gauntlet","images/gauntlet.json").add("bullets","images/bullets.json").add("medkits","images/medkits.json").add("portal","images/portal.png").add("flash","images/flash.png").add("mega","images/mega.json").add("flag","images/flag.json").add("powerup","images/powerup.json").add("armors","images/armors.json").add("items","images/items.json").add("sarge","images/models/sarge.json").add("xaero","images/models/xaero.json").add("keel","images/models/keel.json").add("doom2","images/models/doom2.json").add("crashed","images/models/crashed.json").load((function(t,e){bt.resources=e,"development"==bt.config.mode?bt.demo.load("demo.json",At):bt.demo.loadFromQuery(At);console.log("demo loaded")}))}]);